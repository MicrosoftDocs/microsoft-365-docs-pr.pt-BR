---
title: Detectar e corrigir concessões de consentimento ilícito
f1.keywords:
- NOCSH
ms.author: tracyp
author: MSFTTracyp
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: article
ms.collection:
- o365_security_incident_response
- M365-security-compliance
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
description: Saiba como reconhecer e corrigir o consentimento ilícito conceder ataque no Microsoft Office 365.
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: c7ba6c521c814e4ea44c2dc29ccdad8143d166d4
ms.sourcegitcommit: a45cf8b887587a1810caf9afa354638e68ec5243
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/05/2020
ms.locfileid: "44034823"
---
# <a name="detect-and-remediate-illicit-consent-grants"></a><span data-ttu-id="7b4d7-103">Detectar e corrigir concessões de consentimento ilícito</span><span class="sxs-lookup"><span data-stu-id="7b4d7-103">Detect and Remediate Illicit Consent Grants</span></span>

<span data-ttu-id="7b4d7-104">**Resumo**  Saiba como reconhecer e corrigir o consentimento ilícito conceder ataque no Office 365.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-104">**Summary**  Learn how to recognize and remediate the illicit consent grants attack in Office 365.</span></span>

## <a name="what-is-the-illicit-consent-grant-attack-in-office-365"></a><span data-ttu-id="7b4d7-105">O que é o ataque de concessão de consentimento ilícito no Office 365?</span><span class="sxs-lookup"><span data-stu-id="7b4d7-105">What is the illicit consent grant attack in Office 365?</span></span>

<span data-ttu-id="7b4d7-106">Em um ataque de concessão de consentimento ilícito, o invasor cria um aplicativo registrado pelo Azure que solicita acesso a dados, como informações de contato, email ou documentos.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-106">In an illicit consent grant attack, the attacker creates an Azure-registered application that requests access to data such as contact information, email, or documents.</span></span> <span data-ttu-id="7b4d7-107">O invasor, então, vaza um usuário final para conceder a ele o consentimento de acessar seus dados através de um ataque de phishing ou injetando código ilícito em um site confiável.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-107">The attacker then tricks an end user into granting that application consent to access their data either through a phishing attack, or by injecting illicit code into a trusted website.</span></span> <span data-ttu-id="7b4d7-108">Depois que o aplicativo ilícito tiver sido concedido, ele terá acesso de nível de conta aos dados sem a necessidade de uma conta organizacional.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-108">After the illicit application has been granted consent, it has account-level access to data without the need for an organizational account.</span></span> <span data-ttu-id="7b4d7-109">Etapas de correção normais, como redefinir senhas para contas violadas ou exigir a autenticação multifator (MFA) em contas, não são eficazes contra esse tipo de ataque, já que são aplicativos de terceiros e são externos à organização.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-109">Normal remediation steps, like resetting passwords for breached accounts or requiring Multi-Factor Authentication (MFA) on accounts, are not effective against this type of attack, since these are third-party applications and are external to the organization.</span></span> 

<span data-ttu-id="7b4d7-110">Esses ataques aproveitam um modelo de interação que pressupõe que a entidade que está chamando as informações é automação e não é um homem.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-110">These attacks leverage an interaction model which presumes the entity that is calling the information is automation and not a human.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="7b4d7-111">Você suspeita que está tendo problemas com o consentimento ilícito-subsídios de um aplicativo, agora?</span><span class="sxs-lookup"><span data-stu-id="7b4d7-111">Do you suspect you're experiencing problems with illicit consent-grants from an app, right now?</span></span> <span data-ttu-id="7b4d7-112">O Microsoft Cloud app Security (MCAS) tem ferramentas para detectar, investigar e corrigir seus aplicativos OAuth.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-112">Microsoft Cloud App Security (MCAS) has tools to detect, investigate, and remediate your OAuth apps.</span></span> <span data-ttu-id="7b4d7-113">Este artigo do MCAS tem um tutorial que descreve como [analisar aplicativos OAuth arriscados](https://docs.microsoft.com/cloud-app-security/investigate-risky-oauth).</span><span class="sxs-lookup"><span data-stu-id="7b4d7-113">This MCAS article has a tutorial that outlines how to go about [investigating risky OAuth apps](https://docs.microsoft.com/cloud-app-security/investigate-risky-oauth).</span></span> <span data-ttu-id="7b4d7-114">Você também pode definir [as políticas de aplicativo OAuth](https://docs.microsoft.com/cloud-app-security/app-permission-policy) para investigar as permissões solicitadas pelo aplicativo, quais usuários estão autorizando esses aplicativos e, amplamente, aprovar ou proibir essas solicitações de permissões.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-114">You can also set [OAuth app policies](https://docs.microsoft.com/cloud-app-security/app-permission-policy) to investigate app-requested permissions, which users are authorizing these apps, and widely approve or ban these permissions requests.</span></span>

## <a name="what-does-an-illicit-consent-grant-attack-look-like-in-office-365"></a><span data-ttu-id="7b4d7-115">O que um invasor de concessão de consentimento ilícito parece no Office 365?</span><span class="sxs-lookup"><span data-stu-id="7b4d7-115">What does an illicit consent grant attack look like in Office 365?</span></span>

<span data-ttu-id="7b4d7-116">Você precisa pesquisar o **log de auditoria** para encontrar sinais, também chamados de indicadores de comprometimento (IOC) desse ataque.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-116">You need to search the **audit log** to find signs, also called Indicators of Compromise (IOC) of this attack.</span></span> <span data-ttu-id="7b4d7-117">Para organizações com muitos aplicativos registrados pelo Azure e uma grande base de usuários, a prática recomendada é revisar as autorizações de consentimento de suas organizações por semana.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-117">For organizations with many Azure-registered applications and a large user base, the best practice is to review your organizations consent grants on a weekly basis.</span></span>

### <a name="steps-for-finding-signs-of-this-attack"></a><span data-ttu-id="7b4d7-118">Etapas para encontrar sinais desse ataque</span><span class="sxs-lookup"><span data-stu-id="7b4d7-118">Steps for finding signs of this attack</span></span>

1. <span data-ttu-id="7b4d7-119">Abra o **centro de conformidade & segurança** no locatário.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-119">Open the **Security & Compliance Center** in your tenant.</span></span>

2. <span data-ttu-id="7b4d7-120">Navegue até **pesquisa** e selecione **pesquisa de log de auditoria**.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-120">Navigate to **Search** and select **Audit log search**.</span></span>

3. <span data-ttu-id="7b4d7-121">Pesquisa (todas as atividades e todos os usuários) e insira a data de início e a data de término, se necessário, e clique em **Pesquisar**.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-121">Search (all activities and all users) and enter the start date and end date if required and then click **Search**.</span></span> 

4. <span data-ttu-id="7b4d7-122">Clique em **filtrar resultados** e digite consentimento para o aplicativo no campo **atividade** .</span><span class="sxs-lookup"><span data-stu-id="7b4d7-122">Click **Filter results** and enter Consent to application in the **Activity** field.</span></span>

5. <span data-ttu-id="7b4d7-123">Clique no resultado para ver os detalhes da atividade.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-123">Click on the result to see the details of the activity.</span></span> <span data-ttu-id="7b4d7-124">Clique em **mais informações** para obter detalhes da atividade.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-124">Click **More Information** to get details of the activity.</span></span> <span data-ttu-id="7b4d7-125">Verifique se IsAdminContent está definido como true.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-125">Check to see if IsAdminContent is set to True.</span></span>

> [!NOTE]
> <span data-ttu-id="7b4d7-126">Pode levar de 30 minutos até 24 horas para que a entrada do log de auditoria correspondente seja exibida nos resultados da pesquisa após a ocorrência de um evento.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-126">It can take from 30 minutes up to 24 hours for the corresponding audit log entry to be displayed in the search results after an event occurs.</span></span> <br/><br/> <span data-ttu-id="7b4d7-127">O período de tempo que um registro de auditoria é mantido e pesquisável no log de auditoria depende de sua assinatura do Microsoft 365 e, especificamente, do tipo da licença atribuída a um usuário específico.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-127">The length of time that an audit record is retained and searchable in the audit log depends on your Microsoft 365 subscription, and specifically the type of the license that is assigned to a specific user.</span></span> <span data-ttu-id="7b4d7-128">Para obter mais informações, consulte [log de auditoria](../../compliance/search-the-audit-log-in-security-and-compliance.md).</span><span class="sxs-lookup"><span data-stu-id="7b4d7-128">For more information, see [Audit log](../../compliance/search-the-audit-log-in-security-and-compliance.md).</span></span>
> 
> <span data-ttu-id="7b4d7-129">Se esse valor for true, ele indicará que alguém com acesso de administrador global pode ter concedido acesso amplo aos dados.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-129">If this value is true, it indicates that someone with Global Administrator access may have granted broad access to data.</span></span> <span data-ttu-id="7b4d7-130">Se isso for inesperado, execute etapas para [confirmar um ataque](#how-to-confirm-an-attack).</span><span class="sxs-lookup"><span data-stu-id="7b4d7-130">If this is unexpected, take steps to [confirm an attack](#how-to-confirm-an-attack).</span></span>

## <a name="how-to-confirm-an-attack"></a><span data-ttu-id="7b4d7-131">Como confirmar um ataque</span><span class="sxs-lookup"><span data-stu-id="7b4d7-131">How to confirm an attack</span></span>

<span data-ttu-id="7b4d7-132">Se você tiver uma ou mais instâncias do IOCs listadas acima, precisará fazer mais investigações para confirmar positivamente que o ataque ocorreu.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-132">If you have one or more instances of the IOCs listed above, you need to do further investigation to positively confirm that the attack occurred.</span></span> <span data-ttu-id="7b4d7-133">Você pode usar qualquer um destes três métodos para confirmar o ataque:</span><span class="sxs-lookup"><span data-stu-id="7b4d7-133">You can use any of these three methods to confirm the attack:</span></span>

- <span data-ttu-id="7b4d7-134">Aplicativos de inventário e suas permissões usando o portal do Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-134">Inventory applications and their permissions using the Azure Active Directory portal.</span></span> <span data-ttu-id="7b4d7-135">Este método é completo, mas você só pode verificar um usuário de cada vez, o que pode ser muito demorado se você tiver muitos usuários para verificar.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-135">This method is thorough, but you can only check one user at a time which can be very time consuming if you have many users to check.</span></span>

- <span data-ttu-id="7b4d7-136">Aplicativos de inventário e suas permissões usando o PowerShell.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-136">Inventory applications and their permissions using PowerShell.</span></span> <span data-ttu-id="7b4d7-137">Esse é o método mais rápido e completo, com a menor quantidade de sobrecarga.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-137">This is the fastest and most thorough method, with the least amount of overhead.</span></span>

- <span data-ttu-id="7b4d7-138">Peça aos usuários que verifiquem seus aplicativos e permissões individualmente e relatam os resultados de volta aos administradores para correção.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-138">Have your users individually check their apps and permissions and report the results back to the administrators for remediation.</span></span>

## <a name="inventory-apps-with-access-in-your-organization"></a><span data-ttu-id="7b4d7-139">Aplicativos de inventário com acesso em sua organização</span><span class="sxs-lookup"><span data-stu-id="7b4d7-139">Inventory apps with access in your organization</span></span>

<span data-ttu-id="7b4d7-140">Você pode fazer isso para seus usuários com o portal do Azure Active Directory ou o PowerShell ou fazer com que os usuários enumerem individualmente o acesso ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-140">You can do this for your users with either the Azure Active Directory Portal, or PowerShell or have your users individually enumerate their application access.</span></span>

### <a name="steps-for-using-the-azure-active-directory-portal"></a><span data-ttu-id="7b4d7-141">Etapas para usar o portal do Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="7b4d7-141">Steps for using the Azure Active Directory Portal</span></span>

<span data-ttu-id="7b4d7-142">Você pode pesquisar os aplicativos aos quais qualquer usuário individual concedeu permissões usando o [portal do Azure Active Directory](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="7b4d7-142">You can look up the applications to which any individual user has granted permissions by using the [Azure Active Directory Portal](https://portal.azure.com/).</span></span>

1. <span data-ttu-id="7b4d7-143">Entre no portal do Azure com direitos administrativos.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-143">Sign in to the Azure Portal with administrative rights.</span></span>

2. <span data-ttu-id="7b4d7-144">Selecione a folha do Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-144">Select the Azure Active Directory blade.</span></span>

3. <span data-ttu-id="7b4d7-145">Selecione **Usuários**.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-145">Select **Users**.</span></span>

4. <span data-ttu-id="7b4d7-146">Selecione o usuário que você deseja revisar.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-146">Select the user that you want to review.</span></span>

5. <span data-ttu-id="7b4d7-147">Selecione **aplicativos**.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-147">Select **Applications**.</span></span>

<span data-ttu-id="7b4d7-148">Isso mostrará os aplicativos atribuídos ao usuário e as permissões que os aplicativos têm.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-148">This will show you the apps that are assigned to the user and what permissions the applications have.</span></span>

### <a name="steps-for-having-your-users-enumerate-their-application-access"></a><span data-ttu-id="7b4d7-149">Etapas para que os usuários enumerem o acesso ao aplicativo</span><span class="sxs-lookup"><span data-stu-id="7b4d7-149">Steps for having your users enumerate their application access</span></span>

<span data-ttu-id="7b4d7-150">Peça aos usuários para https://myapps.microsoft.com revisar e examinar o acesso de seu próprio aplicativo.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-150">Have your users go to https://myapps.microsoft.com and review their own application access there.</span></span> <span data-ttu-id="7b4d7-151">Eles devem ser capazes de ver todos os aplicativos com acesso, exibir detalhes sobre eles (incluindo o escopo de acesso) e revogar privilégios para aplicativos suspeitos ou ilícitos.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-151">They should be able to see all the apps with access, view details about them (including the scope of access), and be able to revoke privileges to suspicious or illicit apps.</span></span>

### <a name="steps-for-doing-this-with-powershell"></a><span data-ttu-id="7b4d7-152">Etapas para fazer isso com o PowerShell</span><span class="sxs-lookup"><span data-stu-id="7b4d7-152">Steps for doing this with PowerShell</span></span>

<span data-ttu-id="7b4d7-153">A maneira mais simples de verificar o consentimento ilícito de concessão é executar o [Get-AzureADPSPermissions. ps1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09), que irá despejar todos os subsídios de consentimento OAuth e aplicativos OAuth para todos os usuários em sua locação em um arquivo. csv.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-153">The simplest way to verify the Illicit Consent Grant attack is to run [Get-AzureADPSPermissions.ps1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09), which will dump all the OAuth consent grants and OAuth apps for all users in your tenancy into one .csv file.</span></span>

#### <a name="pre-requisites"></a><span data-ttu-id="7b4d7-154">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="7b4d7-154">Pre-requisites</span></span>

- <span data-ttu-id="7b4d7-155">A biblioteca do Azure AD PowerShell instalada.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-155">The Azure AD PowerShell library installed.</span></span>

- <span data-ttu-id="7b4d7-156">Direitos de administrador global no locatário em que o script será executado.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-156">Global administrator rights on the tenant that the script will be run against.</span></span>

- <span data-ttu-id="7b4d7-157">Administrador local no computador a partir do qual o irá executar os scripts.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-157">Local Administrator on the computer from which will run the scripts.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="7b4d7-158">É ***altamente recomendável*** que você exija a autenticação multifator em sua conta administrativa.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-158">We ***highly recommend*** that you require multi-factor authentication on your administrative account.</span></span> <span data-ttu-id="7b4d7-159">Esse script oferece suporte à autenticação da MFA.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-159">This script supports MFA authentication.</span></span>

1. <span data-ttu-id="7b4d7-160">Entre no computador em que você executará o script com direitos de administrador local.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-160">Sign in to the computer that you will run the script from with local administrator rights.</span></span>

2. <span data-ttu-id="7b4d7-161">Baixe ou copie o script [Get-AzureADPSPermissions. ps1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09) do GitHub para uma pasta a partir da qual você executará o script.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-161">Download or copy the [Get-AzureADPSPermissions.ps1](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09) script from GitHub to a folder from which you will run the script.</span></span> <span data-ttu-id="7b4d7-162">Essa será a mesma pasta para a qual o arquivo de saída "Permissions. csv" será gravado.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-162">This will be the same folder to which the output "permissions.csv" file will be written.</span></span>

3. <span data-ttu-id="7b4d7-163">Abra uma instância do PowerShell como administrador e abra a pasta para a qual você salvou o script.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-163">Open a PowerShell instance as an administrator and open to the folder you saved the script to.</span></span>

4. <span data-ttu-id="7b4d7-164">Conecte-se ao seu diretório usando o cmdlet [Connect-AzureAD](https://docs.microsoft.com/powershell/module/azuread/connect-azuread) .</span><span class="sxs-lookup"><span data-stu-id="7b4d7-164">Connect to your directory using the [Connect-AzureAD](https://docs.microsoft.com/powershell/module/azuread/connect-azuread) cmdlet.</span></span>

5. <span data-ttu-id="7b4d7-165">Execute este comando do PowerShell:</span><span class="sxs-lookup"><span data-stu-id="7b4d7-165">Run this PowerShell command:</span></span>

   ```powershell
   Get-AzureADPSPermissions.ps1 | Export-csv -Path "Permissions.csv" -NoTypeInformation
   ```

<span data-ttu-id="7b4d7-166">O script produz um arquivo chamado Permissions. csv.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-166">The script produces one file named Permissions.csv.</span></span> <span data-ttu-id="7b4d7-167">Siga estas etapas para procurar por subsídios de permissão de aplicativo ilícitos:</span><span class="sxs-lookup"><span data-stu-id="7b4d7-167">Follow these steps to look for illicit application permission grants:</span></span>

1. <span data-ttu-id="7b4d7-168">Na coluna resenttype (coluna G), procure o valor "multiprincípios".</span><span class="sxs-lookup"><span data-stu-id="7b4d7-168">In the ConsentType column (column G) search for the value "AllPrinciples".</span></span> <span data-ttu-id="7b4d7-169">A permissão de entidades de segurança permite que o aplicativo cliente acesse o conteúdo de todos os usuários na locação.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-169">The AllPrincipals permission allows the client application to access everyone's content in the tenancy.</span></span> <span data-ttu-id="7b4d7-170">Os aplicativos nativos da Microsoft 365 precisam que essa permissão funcione corretamente.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-170">Native Microsoft 365 applications need this permission to work correctly.</span></span> <span data-ttu-id="7b4d7-171">Todo aplicativo não-Microsoft com essa permissão deve ser revisado com cuidado.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-171">Every non-Microsoft application with this permission should be reviewed carefully.</span></span>

2. <span data-ttu-id="7b4d7-172">Na coluna permissão (coluna F) revise as permissões que cada aplicativo delegado tem para conteúdo.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-172">In the Permission column (column F) review the permissions that each delegated application has to content.</span></span> <span data-ttu-id="7b4d7-173">Procure por permissões de "leitura" e "gravação" ou "\*. All ", e revise-as cuidadosamente porque elas podem não ser apropriadas.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-173">Look for "Read" and "Write" permission or "\*.All" permission, and review these carefully because they may not be appropriate.</span></span>

3. <span data-ttu-id="7b4d7-174">Revise os usuários específicos que foram concedidos.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-174">Review the specific users that have consents granted.</span></span> <span data-ttu-id="7b4d7-175">Se os usuários de alto perfil ou alto impacto tiverem autorização inadequada, você deverá investigar mais.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-175">If high profile or high impact users have inappropriate consents granted, you should investigate further.</span></span>

4. <span data-ttu-id="7b4d7-176">Na coluna ClientDisplayName (coluna C), procure aplicativos que parecem suspeitos.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-176">In the ClientDisplayName column (column C) look for apps that seem suspicious.</span></span> <span data-ttu-id="7b4d7-177">Os aplicativos com nomes digitados incorretamente, nomes Bland ou nomes de som de hackers devem ser revisados com cuidado.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-177">Apps with misspelled names, super bland names, or hacker-sounding names should be reviewed carefully.</span></span>

## <a name="determine-the-scope-of-the-attack"></a><span data-ttu-id="7b4d7-178">Determinar o escopo do ataque</span><span class="sxs-lookup"><span data-stu-id="7b4d7-178">Determine the scope of the attack</span></span>

<span data-ttu-id="7b4d7-179">Após concluir o inventário do acesso ao aplicativo, revise o **log de auditoria** para determinar o escopo completo da violação.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-179">After you have finished inventorying application access, review the **audit log** to determine the full scope of the breach.</span></span> <span data-ttu-id="7b4d7-180">Pesquisar os usuários afetados, os intervalos de tempo que o aplicativo ilícito tinha acesso à sua organização e as permissões que o aplicativo tinha.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-180">Search on the affected users, the time frames that the illicit application had access to your organization, and the permissions the app had.</span></span> <span data-ttu-id="7b4d7-181">Você pode pesquisar o **log de auditoria** no [centro de segurança e conformidade do Microsoft 365](https://docs.microsoft.com/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance).</span><span class="sxs-lookup"><span data-stu-id="7b4d7-181">You can search the **audit log** in the [Microsoft 365 Security and Compliance Center](https://docs.microsoft.com/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="7b4d7-182">A [auditoria de caixa de correio](https://docs.microsoft.com/microsoft-365/compliance/enable-mailbox-auditing) e [a auditoria de atividades para administradores e usuários](https://docs.microsoft.com/microsoft-365/compliance/turn-audit-log-search-on-or-off) devem ter sido habilitadas antes do ataque para obter essas informações.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-182">[Mailbox auditing](https://docs.microsoft.com/microsoft-365/compliance/enable-mailbox-auditing) and [Activity auditing for admins and users](https://docs.microsoft.com/microsoft-365/compliance/turn-audit-log-search-on-or-off) must have been enabled prior to the attack for you to get this information.</span></span>

## <a name="how-to-stop-and-remediate-an-illicit-consent-grant-attack"></a><span data-ttu-id="7b4d7-183">Como interromper e corrigir um ataque de concessão de consentimento ilícito</span><span class="sxs-lookup"><span data-stu-id="7b4d7-183">How to stop and remediate an illicit consent grant attack</span></span>

<span data-ttu-id="7b4d7-184">Após identificar um aplicativo com permissões ilícita, você tem várias maneiras de remover esse acesso.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-184">After you have identified an application with illicit permissions, you have several ways to remove that access.</span></span>

- <span data-ttu-id="7b4d7-185">Você pode revogar a permissão do aplicativo no portal do Azure Active Directory:</span><span class="sxs-lookup"><span data-stu-id="7b4d7-185">You can revoke the application's permission in the Azure Active Directory Portal by:</span></span>

  - <span data-ttu-id="7b4d7-186">Navegue até o usuário afetado na folha de **usuários do Azure Active Directory** .</span><span class="sxs-lookup"><span data-stu-id="7b4d7-186">Navigate to the affected user in the **Azure Active Directory User** blade.</span></span>

  - <span data-ttu-id="7b4d7-187">Selecione **aplicativos**.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-187">Select **Applications**.</span></span>

  - <span data-ttu-id="7b4d7-188">Selecione o aplicativo ilícito.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-188">Select the illicit application.</span></span>

  - <span data-ttu-id="7b4d7-189">Clique em **remover** na busca detalhada.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-189">Click **Remove** in the drill down.</span></span>

- <span data-ttu-id="7b4d7-190">Você pode revogar a concessão de consentimento OAuth com o PowerShell seguindo as etapas em [Remove-AzureADOAuth2PermissionGrant](https://docs.microsoft.com/powershell/module/azuread/Remove-AzureADOAuth2PermissionGrant).</span><span class="sxs-lookup"><span data-stu-id="7b4d7-190">You can revoke the OAuth consent grant with PowerShell by following the steps in [Remove-AzureADOAuth2PermissionGrant](https://docs.microsoft.com/powershell/module/azuread/Remove-AzureADOAuth2PermissionGrant).</span></span>

- <span data-ttu-id="7b4d7-191">Você pode revogar a atribuição da função de aplicativo de serviço com o PowerShell seguindo as etapas em [Remove-AzureADServiceAppRoleAssignment](https://docs.microsoft.com/powershell/module/azuread/Remove-AzureADServiceAppRoleAssignment).</span><span class="sxs-lookup"><span data-stu-id="7b4d7-191">You can revoke the Service App Role Assignment with PowerShell by following the steps in [Remove-AzureADServiceAppRoleAssignment](https://docs.microsoft.com/powershell/module/azuread/Remove-AzureADServiceAppRoleAssignment).</span></span>

- <span data-ttu-id="7b4d7-192">Você também pode desabilitar a entrada para a conta afetada, o que, por sua vez, desabilitará o acesso do aplicativo aos dados dessa conta.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-192">You can also disable sign-in for the affected account altogether, which will in turn disable app access to data in that account.</span></span> <span data-ttu-id="7b4d7-193">Isso não é ideal para a produtividade do usuário final, mas se você estiver trabalhando para limitar o impacto rapidamente, pode ser uma remediação de curto prazo viável.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-193">This isn't ideal for the end user's productivity, of course, but if you are working to limit impact quickly, it can be a viable short-term remediation.</span></span>

- <span data-ttu-id="7b4d7-194">Você pode desativar aplicativos integrados para sua locação.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-194">You can turn integrated applications off for your tenancy.</span></span> <span data-ttu-id="7b4d7-195">Esta é uma etapa drástica que desabilita a capacidade de os usuários finais concederem o consentimento por todo o locatário.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-195">This is a drastic step that disables the ability for end users to grant consent on a tenant-wide basis.</span></span> <span data-ttu-id="7b4d7-196">Isso impede que os usuários conceda acidentalmente acesso a um aplicativo mal-intencionado.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-196">This prevents your users from inadvertently granting access to a malicious application.</span></span> <span data-ttu-id="7b4d7-197">Isso não é altamente recomendado, pois ele prejudica seriamente a capacidade dos usuários de ser produtiva com aplicativos de terceiros.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-197">This isn't strongly recommended as it severely impairs your users' ability to be productive with third party applications.</span></span> <span data-ttu-id="7b4d7-198">Você pode fazer isso seguindo as etapas em [ativando ou desativando aplicativos integrados](https://docs.microsoft.com/office365/admin/misc/integrated-apps).</span><span class="sxs-lookup"><span data-stu-id="7b4d7-198">You can do this by following the steps in [Turning Integrated Apps on or off](https://docs.microsoft.com/office365/admin/misc/integrated-apps).</span></span>

## <a name="secure-microsoft-365-like-a-cybersecurity-pro"></a><span data-ttu-id="7b4d7-199">Proteja o Microsoft 365 como um profissional de segurança cibernética</span><span class="sxs-lookup"><span data-stu-id="7b4d7-199">Secure Microsoft 365 like a cybersecurity pro</span></span>

<span data-ttu-id="7b4d7-200">Sua assinatura do Microsoft 365 vem com um poderoso conjunto de recursos de segurança que você pode usar para proteger seus dados e seus usuários.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-200">Your Microsoft 365 subscription comes with a powerful set of security capabilities that you can use to protect your data and your users.</span></span> <span data-ttu-id="7b4d7-201">Use o [roteiro de segurança do Microsoft 365: principais prioridades para os primeiros 30 dias, 90 dias e depois](security-roadmap.md) para implementar práticas recomendadas para proteger o seu locatário do Microsoft 365.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-201">Use the [Microsoft 365 security roadmap - Top priorities for the first 30 days, 90 days, and beyond](security-roadmap.md) to implement Microsoft recommended best practices for securing your Microsoft 365 tenant.</span></span>

- <span data-ttu-id="7b4d7-202">Tarefas a realizar nos primeiros 30 dias.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-202">Tasks to accomplish in the first 30 days.</span></span> <span data-ttu-id="7b4d7-203">Estas têm efeito imediato e baixo impacto para seus usuários.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-203">These have immediate affect and are low-impact to your users.</span></span>

- <span data-ttu-id="7b4d7-204">Tarefas para realizar em 90 dias.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-204">Tasks to accomplish in 90 days.</span></span> <span data-ttu-id="7b4d7-205">Estas levam um pouco mais de tempo para planejar e implementar, mas melhoram muito sua postura de segurança.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-205">These take a bit more time to plan and implement but greatly improve your security posture.</span></span>

- <span data-ttu-id="7b4d7-206">Além de 90 dias.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-206">Beyond 90 days.</span></span> <span data-ttu-id="7b4d7-207">Estes aprimoramentos são desenvolvidos nos seus primeiros 90 dias de trabalho.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-207">These enhancements build in your first 90 days work.</span></span>

## <a name="see-also"></a><span data-ttu-id="7b4d7-208">Confira também:</span><span class="sxs-lookup"><span data-stu-id="7b4d7-208">See also:</span></span>

- <span data-ttu-id="7b4d7-209">[Aplicativo inesperado na lista meus aplicativos](https://docs.microsoft.com/azure/active-directory/application-access-unexpected-application) orienta os administradores por meio de várias ações que podem ser tomadas após perceber que há aplicativos inesperados com acesso aos dados.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-209">[Unexpected application in my applications list](https://docs.microsoft.com/azure/active-directory/application-access-unexpected-application) walks administrators through various actions they may want to take after realizing there are unexpected applications with access to data.</span></span>

- <span data-ttu-id="7b4d7-210">A [integração de aplicativos com o Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-apps-permissions-consent) é uma visão geral de consentimento e permissões de alto nível.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-210">[Integrating applications with Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-apps-permissions-consent) is a high-level overview of consent and permissions.</span></span>

- <span data-ttu-id="7b4d7-211">[Problemas para desenvolver meu aplicativo](https://docs.microsoft.com/azure/active-directory/active-directory-application-dev-development-content-map) fornece links para vários artigos relacionados a consentimento.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-211">[Problems developing my application](https://docs.microsoft.com/azure/active-directory/active-directory-application-dev-development-content-map) provides links to various consent related articles.</span></span>

- <span data-ttu-id="7b4d7-212">Os [objetos de entidade de serviço e de aplicativo no Azure Active Directory (Azure AD)](https://docs.microsoft.com/azure/active-directory/develop/active-directory-application-objects) fornece uma visão geral dos objetos de entidade de serviço e aplicativo que são fundamentais para o modelo de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-212">[Application and service principal objects in Azure Active Directory (Azure AD)](https://docs.microsoft.com/azure/active-directory/develop/active-directory-application-objects) provides an overview of the Application and Service principal objects that are core to the application model.</span></span>

- <span data-ttu-id="7b4d7-213">[Manage Access to apps](https://docs.microsoft.com/azure/active-directory/active-directory-managing-access-to-apps) é uma visão geral dos recursos que os administradores precisam para gerenciar o acesso de usuários aos aplicativos.</span><span class="sxs-lookup"><span data-stu-id="7b4d7-213">[Manage access to apps](https://docs.microsoft.com/azure/active-directory/active-directory-managing-access-to-apps) is an overview of the capabilities that administrators have to manage user access to apps.</span></span>
