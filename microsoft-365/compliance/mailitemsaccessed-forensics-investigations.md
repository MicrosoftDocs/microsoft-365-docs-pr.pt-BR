---
title: Usar a Auditoria Avançada para investigar contas comprometidas
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
audience: Admin
ms.topic: article
ms.service: O365-seccomp
localization_priority: Priority
ms.collection:
- M365-security-compliance
search.appverid:
- MOE150
- MET150
ms.assetid: ''
description: Use a ação de auditoria da caixa de correio MailItemsAccessed para executar investigações de perícia das contas de usuários comprometidas.
ms.openlocfilehash: 20c57f1d11af8fded15cc2fdf280414f7172ffd7
ms.sourcegitcommit: 22e9f54d0d3ead2be91a38d49325308c70f43f90
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/15/2020
ms.locfileid: "44262574"
---
# <a name="use-advanced-audit-to-investigate-compromised-accounts"></a><span data-ttu-id="a8961-103">Usar a Auditoria Avançada para investigar contas comprometidas</span><span class="sxs-lookup"><span data-stu-id="a8961-103">Use Advanced Audit to investigate compromised accounts</span></span>

<span data-ttu-id="a8961-104">Uma conta de usuário comprometida (também chamada de *tomada de controle da conta*) é um tipo de ataque quando um invasor obtém acesso a uma conta de usuário e opera como o usuário.</span><span class="sxs-lookup"><span data-stu-id="a8961-104">A compromised user account (also called an *account takeover*) is a type of attack when an attacker gains access to a user account and operates as the user.</span></span> <span data-ttu-id="a8961-105">Esses tipos de ataques, às vezes, causam mais danos do que o invasor planejou.</span><span class="sxs-lookup"><span data-stu-id="a8961-105">These types of attacks sometimes cause more damage than the attacker may have intended.</span></span> <span data-ttu-id="a8961-106">Ao investigar contas de email comprometidas, você deve supor que mais dados de email foram comprometidos do que foi indicado ao rastrear a presença real do invasor.</span><span class="sxs-lookup"><span data-stu-id="a8961-106">When investigating compromised email accounts, you have to assume that more mail data was compromised than may be indicated by tracing the attacker's actual presence.</span></span> <span data-ttu-id="a8961-107">Dependendo do tipo de dados nas mensagens de email, você deve supor que as informações confidenciais foram comprometidas ou pagar multas regulatórias, a menos que seja possível provar que as informações confidenciais não tenham sido expostas.</span><span class="sxs-lookup"><span data-stu-id="a8961-107">Depending on the type of data in email messages, you have to assume that sensitive information was compromised or face regulatory fines unless you can prove that sensitive information wasn't exposed.</span></span> <span data-ttu-id="a8961-108">Por exemplo, as organizações regulamentadas pelo HIPAA terão de pagar multas significativas se houver evidências de que as informações de saúde do paciente (PHI) tenham sido expostas.</span><span class="sxs-lookup"><span data-stu-id="a8961-108">For example, HIPAA-regulated organizations face significant fines if there is evidence that patient health information (PHI) was exposed.</span></span> <span data-ttu-id="a8961-109">Nesses casos, os invasores provavelmente não têm interesse nas PHI, mas as organizações ainda devem relatar violações de dados, a menos que possam provar o contrário.</span><span class="sxs-lookup"><span data-stu-id="a8961-109">In these cases, attackers are unlikely to be interested in PHI, but organizations still must report data breaches unless they can prove otherwise.</span></span>

<span data-ttu-id="a8961-110">Para ajudá-lo a investigar contas de email comprometidas, agora vamos auditar os acessos de dados de email por protocolos e clientes de email com a ação de auditoria da caixa de correio *MailItemsAccessed*.</span><span class="sxs-lookup"><span data-stu-id="a8961-110">To help you with investigating compromise email accounts, we're now auditing accesses of mail data by mail protocols and clients with the *MailItemsAccessed* mailbox auditing action.</span></span> <span data-ttu-id="a8961-111">Essa nova ação de auditoria ajudará os investigadores a entender melhor as violações de dados de email e o ajudarão a identificar o escopo de comprometimentos em itens de email específicos que possam ter sido comprometidos.</span><span class="sxs-lookup"><span data-stu-id="a8961-111">This new audited action will help investigators better understand email data breaches and help you identify the scope of compromises to specific mail items that may been compromised.</span></span> <span data-ttu-id="a8961-112">O objetivo de usar essa nova ação de auditoria é a defensibilidade de perícia para ajudar a afirmar que um trecho específico de dados de email não foi comprometido.</span><span class="sxs-lookup"><span data-stu-id="a8961-112">The goal of using this new auditing action is forensics defensibility to help assert that a specific piece of mail data was not compromised.</span></span> <span data-ttu-id="a8961-113">Se um invasor obtiver acesso a um email específico, o Exchange Online auditará o evento mesmo que não haja indicação de que o item de email foi realmente lido.</span><span class="sxs-lookup"><span data-stu-id="a8961-113">If an attacker gained access to a specific piece of mail, Exchange Online audits the event even though there is no indication that the mail item was actually read.</span></span>

## <a name="the-mailitemsaccessed-mailbox-auditing-action"></a><span data-ttu-id="a8961-114">A ação de auditoria da caixa de correio MailItemsAccessed</span><span class="sxs-lookup"><span data-stu-id="a8961-114">The MailItemsAccessed mailbox auditing action</span></span>

<span data-ttu-id="a8961-115">A nova ação MailItemsAccessed faz parte da nova funcionalidade [Auditoria Avançada](advanced-audit.md).</span><span class="sxs-lookup"><span data-stu-id="a8961-115">The new MailItemsAccessed action is part of the new [Advanced Audit](advanced-audit.md) functionality.</span></span> <span data-ttu-id="a8961-116">Faz parte da [auditoria de caixa de email do Exchange](https://docs.microsoft.com/office365/securitycompliance/enable-mailbox-auditing#mailbox-auditing-actions) e é habilitada por padrão para os usuários que recebem uma licença do Office 365 ou Microsoft 365 E5 ou para organizações com uma assinatura complementar da Conformidade do Microsoft 365 E5.</span><span class="sxs-lookup"><span data-stu-id="a8961-116">It's part of [Exchange mailbox auditing](https://docs.microsoft.com/office365/securitycompliance/enable-mailbox-auditing#mailbox-auditing-actions) and is enabled by default for users that are assigned an Office 365 or Microsoft 365 E5 license or for organizations with a Microsoft 365 E5 Compliance add-on subscription.</span></span>

<span data-ttu-id="a8961-117">A ação de auditoria da caixa de correio MailItemsAccessed abrange todos os protocolos de email: POP, IMAP, MAPI, EWS, Exchange ActiveSync e REST.</span><span class="sxs-lookup"><span data-stu-id="a8961-117">The MailItemsAccessed mailbox auditing action covers all mail protocols: POP, IMAP, MAPI, EWS, Exchange ActiveSync, and REST.</span></span> <span data-ttu-id="a8961-118">Ela também aborda os dois tipos de acesso a email: *sincronização* e *vinculação*.</span><span class="sxs-lookup"><span data-stu-id="a8961-118">It also covers both types of accessing mail: *sync* and *bind*.</span></span>

### <a name="auditing-sync-access"></a><span data-ttu-id="a8961-119">Auditoria do acesso de sincronização</span><span class="sxs-lookup"><span data-stu-id="a8961-119">Auditing sync access</span></span>

<span data-ttu-id="a8961-120">As operações de sincronização só são registradas quando uma caixa de correio é acessada por uma versão de área de trabalho do cliente do Outlook para Windows ou Mac.</span><span class="sxs-lookup"><span data-stu-id="a8961-120">Sync operations are only recorded when a mailbox is accessed by a desktop version of the Outlook client for Windows or Mac.</span></span> <span data-ttu-id="a8961-121">Durante a operação de sincronização, esses clientes geralmente baixam um grande conjunto de itens de email da nuvem para um computador local.</span><span class="sxs-lookup"><span data-stu-id="a8961-121">During the sync operation, these clients typically download a large set of mail items from the cloud to a local computer.</span></span> <span data-ttu-id="a8961-122">O volume de auditoria para operações de sincronização é enorme.</span><span class="sxs-lookup"><span data-stu-id="a8961-122">The audit volume for sync operations is huge.</span></span> <span data-ttu-id="a8961-123">Então, em vez de gerar um registro de auditoria para item de email que é sincronizado, basta gerar um evento de auditoria para a pasta de email com os itens que foram sincronizados.</span><span class="sxs-lookup"><span data-stu-id="a8961-123">So, instead of generating an audit record for each mail item that's synched, we just generate an audit event for the mail folder containing items that were synched.</span></span> <span data-ttu-id="a8961-124">Isso supõe que *todos* os itens de email na pasta sincronizada foram comprometidos.</span><span class="sxs-lookup"><span data-stu-id="a8961-124">This makes the assumption that *all* mail items in the synched folder have been compromised.</span></span> <span data-ttu-id="a8961-125">O tipo de acesso é registrado no campo OperationsProperties do registro de auditoria.</span><span class="sxs-lookup"><span data-stu-id="a8961-125">The access type is recorded in the OperationsProperties field of the audit record.</span></span> 

<span data-ttu-id="a8961-126">Confira a etapa 2 na seção [Usar os registros de auditoria MailItemsAccessed para investigações de perícia](#use-mailitemsaccessed-audit-records-for-forensic-investigations) para obter um exemplo de como exibir o tipo de acesso de sincronização em um registro de auditoria.</span><span class="sxs-lookup"><span data-stu-id="a8961-126">See step 2 in the [Use MailItemsAccessed audit records for forensic investigations](#use-mailitemsaccessed-audit-records-for-forensic-investigations) section for an example of displaying the sync access type in an audit record.</span></span>

### <a name="auditing-bind-access"></a><span data-ttu-id="a8961-127">Auditoria do acesso de vinculação</span><span class="sxs-lookup"><span data-stu-id="a8961-127">Auditing bind access</span></span>

<span data-ttu-id="a8961-128">Uma operação de vinculação é um acesso individual a uma mensagem de email.</span><span class="sxs-lookup"><span data-stu-id="a8961-128">A bind operation is an individual access to an email message.</span></span> <span data-ttu-id="a8961-129">Para o acesso de vinculação, o internet-message-id das mensagens individuais será gravado no registro de auditoria.</span><span class="sxs-lookup"><span data-stu-id="a8961-129">For bind access, the internet-message-id of individual messages will be recorded in the audit record.</span></span> <span data-ttu-id="a8961-130">A ação de auditoria MailItemsAccessed registra as operações de vinculação e, em seguida, agrega-as em um único registro de auditoria.</span><span class="sxs-lookup"><span data-stu-id="a8961-130">The MailItemsAccessed audit action records bind operations and then aggregates into a single audit record.</span></span> <span data-ttu-id="a8961-131">Todas as operações de vinculação que ocorrem em um intervalo de 2 minutos são agregadas em um único registro de auditoria no campo Pastas dentro da propriedade AuditData.</span><span class="sxs-lookup"><span data-stu-id="a8961-131">All bind operations that occur within a 2-minute interval are aggregated in a single audit record in the Folders field within the AuditData property.</span></span> <span data-ttu-id="a8961-132">Cada mensagem que foi acessada é identificada pelo internet-message-id. O número de operações de vinculação agregadas no registro é exibido no campo OperationCount na propriedade AuditData.</span><span class="sxs-lookup"><span data-stu-id="a8961-132">Each message that was accessed is identified by its internet-message-id. The number of bind operations that were aggregated in the record is displayed in the OperationCount field in the AuditData property.</span></span>

<span data-ttu-id="a8961-133">Confira a etapa 4 na seção [Usar os registros de auditoria MailItemsAccessed para investigações forenses](#use-mailitemsaccessed-audit-records-for-forensic-investigations) para obter um exemplo de como exibir o tipo de acesso de vinculação em um registro de auditoria.</span><span class="sxs-lookup"><span data-stu-id="a8961-133">See step 4 in the [Use MailItemsAccessed audit records for forensic investigations](#use-mailitemsaccessed-audit-records-for-forensic-investigations) section for an example of displaying the bind access type in an audit record.</span></span>

### <a name="throttling-of-mailitemsaccessed-audit-records"></a><span data-ttu-id="a8961-134">Limitação de registros de auditoria MailItemsAccessed</span><span class="sxs-lookup"><span data-stu-id="a8961-134">Throttling of MailItemsAccessed audit records</span></span>

<span data-ttu-id="a8961-135">Se mais de 1.000 registros de auditoria MailItemsAccessed forem gerados em menos de 24 horas, o Exchange Online deixará de gerar registros de auditoria para a atividade MailItemsAccessed.</span><span class="sxs-lookup"><span data-stu-id="a8961-135">If more than 1,000 MailItemsAccessed audit records are generated in less than 24 hours, Exchange Online will stop generating auditing records for MailItemsAccessed activity.</span></span> <span data-ttu-id="a8961-136">Quando uma caixa de correio é limitada, a atividade MailItemsAccessed não será registrada por 24 horas após a limitação da caixa de correio.</span><span class="sxs-lookup"><span data-stu-id="a8961-136">When a mailbox is throttled, MailItemsAccessed activity will not be logged for 24 hours after the mailbox was throttled.</span></span> <span data-ttu-id="a8961-137">Se isso ocorrer, há uma possibilidade de que a caixa de correio tenha sido comprometida durante esse período.</span><span class="sxs-lookup"><span data-stu-id="a8961-137">If this occurs, there's a potential that mailbox could have been compromised during this period.</span></span> <span data-ttu-id="a8961-138">A gravação da atividade MailItemsAccessed será retomada após um período de 24 horas.</span><span class="sxs-lookup"><span data-stu-id="a8961-138">The recording of MailItemsAccessed activity will be resumed following a 24-hour period.</span></span>  

<span data-ttu-id="a8961-139">Aqui estão alguns pontos para lembrar sobre a limitação:</span><span class="sxs-lookup"><span data-stu-id="a8961-139">Here's a few things to keep in mind about throttling:</span></span>

- <span data-ttu-id="a8961-140">Menos de 1% de todas as caixas de correio no Exchange Online são limitadas.</span><span class="sxs-lookup"><span data-stu-id="a8961-140">Less than 1% of all mailboxes in Exchange Online are throttled</span></span>

- <span data-ttu-id="a8961-141">Quando uma caixa de correio é limitada, apenas os registros de auditoria para a atividade MailItemsAccessed não são auditados.</span><span class="sxs-lookup"><span data-stu-id="a8961-141">When a mailbox is throttling, only audit records for MailItemsAccessed activity are not audited.</span></span> <span data-ttu-id="a8961-142">Outras ações de auditoria da caixa de correio não são afetadas.</span><span class="sxs-lookup"><span data-stu-id="a8961-142">Other mailbox auditing actions aren't affected.</span></span>

- <span data-ttu-id="a8961-143">As caixas de correio são limitadas apenas para operações de vinculação.</span><span class="sxs-lookup"><span data-stu-id="a8961-143">Mailboxes are throttled only for Bind operations.</span></span> <span data-ttu-id="a8961-144">Os registros de auditoria para operações de sincronização não são limitados.</span><span class="sxs-lookup"><span data-stu-id="a8961-144">Audit records for sync operations are not throttled.</span></span>

- <span data-ttu-id="a8961-145">Se uma caixa de correio for limitada, você poderá supor que havia uma atividade MailItemsAccessed que não foi gravada no logs de auditoria.</span><span class="sxs-lookup"><span data-stu-id="a8961-145">If a mailbox is throttled, you can probably assume there was MailItemsAccessed activity that wasn't recorded in the audit logs.</span></span>

<span data-ttu-id="a8961-146">Confira a etapa 1 na seção [Usar registros de auditoria MailItemsAccessed para investigações de perícia](#use-mailitemsaccessed-audit-records-for-forensic-investigations) para obter um exemplo de como exibir a propriedade IsThrottled em um registro de auditoria.</span><span class="sxs-lookup"><span data-stu-id="a8961-146">See step 1 in the [Use MailItemsAccessed audit records for forensic investigations](#use-mailitemsaccessed-audit-records-for-forensic-investigations) section for an example of displaying the IsThrottled property in an audit record.</span></span>

## <a name="use-mailitemsaccessed-audit-records-for-forensic-investigations"></a><span data-ttu-id="a8961-147">Use os registros de auditoria MailItemsAccessed para investigações de perícia</span><span class="sxs-lookup"><span data-stu-id="a8961-147">Use MailItemsAccessed audit records for forensic investigations</span></span>

<span data-ttu-id="a8961-148">A auditoria de caixa de correio gera registros de auditoria para acesso a mensagens de email para que você tenha certeza de que as mensagens de email não foram comprometidas.</span><span class="sxs-lookup"><span data-stu-id="a8961-148">Mailbox auditing generates audit records for access to email messages so that you can be confident that email messages haven't been compromised.</span></span> <span data-ttu-id="a8961-149">Por esse motivo, em situações em que não sabemos que alguns dados foram acessados, supomos que foram acessados gravando todas as atividades de acesso ao email.</span><span class="sxs-lookup"><span data-stu-id="a8961-149">For this reason, in circumstances where we're not certain that some data has been accessed, we assume that it has by recording all mail access activity.</span></span>

<span data-ttu-id="a8961-150">Geralmente usa-se os registros de auditoria MailItemsAccessed para fins de perícia após uma violação de dados ser resolvida e o invasor ser removido.</span><span class="sxs-lookup"><span data-stu-id="a8961-150">Using MailItemsAccessed audit records for forensics purposes is typically performed after a data breach has been resolved and the attacker has been evicted.</span></span> <span data-ttu-id="a8961-151">Para iniciar a investigação, identifique o conjunto de caixas de correio que foram comprometidas e determine o período de tempo em que o invasor teve acesso às caixas de correio em sua organização.</span><span class="sxs-lookup"><span data-stu-id="a8961-151">To begin your investigation, you should identify the set of mailboxes that they have been compromised and determine the time frame when attacker had access to mailboxes in your organization.</span></span> <span data-ttu-id="a8961-152">Em seguida, você pode usar os cmdlets **Search-UnifiedAuditLog** ou **Search-MailboxAuditLog** no [PowerShell do Exchange Online](https://docs.microsoft.com/powershell/exchange/exchange-online/connect-to-exchange-online-powershell/connect-to-exchange-online-powershell) para pesquisar registros de auditoria que correspondem à violação de dados.</span><span class="sxs-lookup"><span data-stu-id="a8961-152">Then, you can use the **Search-UnifiedAuditLog** or **Search-MailboxAuditLog** cmdlets in [Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/exchange-online/connect-to-exchange-online-powershell/connect-to-exchange-online-powershell) to search audit records that correspond to the data breach.</span></span> 

<span data-ttu-id="a8961-153">Você pode executar um dos seguintes comandos para pesquisar registros de auditoria MailItemsAccessed:</span><span class="sxs-lookup"><span data-stu-id="a8961-153">You can run one of the following commands to search for MailItemsAccessed audit records:</span></span>

<span data-ttu-id="a8961-154">**Log de auditoria unificada**</span><span class="sxs-lookup"><span data-stu-id="a8961-154">**Unified audit log**</span></span>

```powershell
Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000
```

<span data-ttu-id="a8961-155">**Log de auditoria de caixa de correio**</span><span class="sxs-lookup"><span data-stu-id="a8961-155">**Mailbox audit log**</span></span>

```powershell
Search-MailboxAuditLog -Identity <user> -StartDate 01/06/2020 -EndDate 01/20/2020 -Operations MailItemsAccessed -ResultSize 1000 -ShowDetails
```

> [!TIP]
> <span data-ttu-id="a8961-156">Uma grande diferença entre esses dois cmdlets é que você pode usar o cmdlet **Search-UnifiedAuditLog** para pesquisar em registros de auditoria atividades realizadas por um ou mais usuários.</span><span class="sxs-lookup"><span data-stu-id="a8961-156">One primary difference between these two cmdlets in that you can use the **Search-UnifiedAuditLog** cmdlet to search for audit records for activity performed by one or more users.</span></span> <span data-ttu-id="a8961-157">Isso ocorre porque *UserIds* é um parâmetro de vários valores.</span><span class="sxs-lookup"><span data-stu-id="a8961-157">That's because *UserIds* is a multi-value parameter.</span></span> <span data-ttu-id="a8961-158">O cmdlet **Search-MailboxAuditLog** pesquisa o log de auditoria da caixa de correio para um único usuário.</span><span class="sxs-lookup"><span data-stu-id="a8961-158">The **Search-MailboxAuditLog** cmdlet searches the mailbox audit log for a single user.</span></span>

<span data-ttu-id="a8961-159">Estas são as etapas para usar os registros de auditoria MailItemsAccessed para investigar uma invasão a um usuário comprometido.</span><span class="sxs-lookup"><span data-stu-id="a8961-159">Here are the steps for using MailItemsAccessed audit records to investigate a compromised user attack.</span></span> <span data-ttu-id="a8961-160">Cada etapa mostra a sintaxe de comando para os cmdlets **Search-UnifiedAuditLog** ou **Search-MailboxAuditLog**.</span><span class="sxs-lookup"><span data-stu-id="a8961-160">Each step shows the command syntax for the **Search-UnifiedAuditLog** or **Search-MailboxAuditLog** cmdlets.</span></span>

1. <span data-ttu-id="a8961-161">Verifique se a caixa de correio foi limitada.</span><span class="sxs-lookup"><span data-stu-id="a8961-161">Check whether the mailbox has been throttled.</span></span> <span data-ttu-id="a8961-162">Caso tenha sido, isso significa que alguns registros de auditoria da caixa de correio não foram registrados.</span><span class="sxs-lookup"><span data-stu-id="a8961-162">If so, this would mean that some mailbox auditing records would not have been logged.</span></span> <span data-ttu-id="a8961-163">Caso nenhum registro de auditoria tenha o “IsThrottled é “Verdadeiro”, você deve supor que, por um período de 24 horas depois desse registro ser gerado, nenhum acesso à caixa de correio foi auditado e que todos os dados de email foram comprometidos.</span><span class="sxs-lookup"><span data-stu-id="a8961-163">In the case that any audit records have the "IsThrottled" is "True," you should assume that for a 24-hour period afterwards that record was generated, that any access to the mailbox was not audited and that all mail data has been compromised.</span></span>

   <span data-ttu-id="a8961-164">Para procurar registros MailItemsAccessed em que a caixa de correio foi limitada, execute o seguinte comando:</span><span class="sxs-lookup"><span data-stu-id="a8961-164">To search for MailItemsAccessed records where the mailbox was throttled, run the following command:</span></span>

   <span data-ttu-id="a8961-165">**Log de auditoria unificada**</span><span class="sxs-lookup"><span data-stu-id="a8961-165">**Unified audit log**</span></span>
 
   ```powershell
   Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000 | Where {$_.AuditData -like '*"IsThrottled","Value":"True"*'} | FL
   ```

   <span data-ttu-id="a8961-166">**Log de auditoria de caixa de correio**</span><span class="sxs-lookup"><span data-stu-id="a8961-166">**Mailbox audit log**</span></span>

   ```powershell
   Search-MailboxAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -Identity <user> -Operations MailItemsAccessed -ResultSize 10000 -ShowDetails | Where {$_.OperationProperties -like "*IsThrottled:True*"} | FL
   ```

2. <span data-ttu-id="a8961-167">Verifique se há atividades de sincronização.</span><span class="sxs-lookup"><span data-stu-id="a8961-167">Check for sync activities.</span></span> <span data-ttu-id="a8961-168">Se um invasor usa um cliente de email para baixar mensagens em uma caixa de correio, ele pode desconectar o computador da Internet e acessar as mensagens localmente sem interagir com o servidor.</span><span class="sxs-lookup"><span data-stu-id="a8961-168">If an attacker uses an email client to downloaded messages in a mailbox, they can disconnect the computer from the Internet and access the messages locally without interacting with the server.</span></span> <span data-ttu-id="a8961-169">Isso significa que a auditoria de caixa de correio não conseguiria auditar essas atividades.</span><span class="sxs-lookup"><span data-stu-id="a8961-169">This means that mailbox auditing would not be able to audit these activities.</span></span>

   <span data-ttu-id="a8961-170">Para procurar registros MailItemsAccessed em que os itens de email foram acessados por uma operação de sincronização, execute o seguinte comando:</span><span class="sxs-lookup"><span data-stu-id="a8961-170">To search for MailItemsAccessed records where the mail items were accessed by a sync operation, run the following command:</span></span>

   <span data-ttu-id="a8961-171">**Log de auditoria unificada**</span><span class="sxs-lookup"><span data-stu-id="a8961-171">**Unified audit log**</span></span>

   ```powershell
   Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 02/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000 | Where {$_.AuditData -like '*"MailAccessType","Value":"Sync"*'} | FL
   ```

   <span data-ttu-id="a8961-172">**Log de auditoria de caixa de correio**</span><span class="sxs-lookup"><span data-stu-id="a8961-172">**Mailbox audit log**</span></span>

   ```powershell
   Search-MailboxAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -Identity <user> -Operations MailItemsAccessed -ResultSize 10000 -ShowDetails | Where {$_.OperationProperties -like "*MailAccessType:Sync*"} | FL
   ```

3. <span data-ttu-id="a8961-173">Verifique as atividades de sincronização para determinar se alguma delas ocorreu no mesmo contexto que aquele usado pelo invasor para acessar a caixa de correio.</span><span class="sxs-lookup"><span data-stu-id="a8961-173">Check sync activities to determine in any of them have occurred in the same context as the one used by the attacker access the mailbox.</span></span> <span data-ttu-id="a8961-174">O contexto é identificado e diferenciado pelo endereço IP do computador cliente usado para acessar a caixa de correio e o protocolo de email.</span><span class="sxs-lookup"><span data-stu-id="a8961-174">Context is identified and differentiated by the IP address of the client computer used to access the mailbox and the mail protocol.</span></span> <span data-ttu-id="a8961-175">Para obter mais informações, confira a seção [Identificar os contextos de acesso de diferentes registros de auditoria](#identifying-the-access-contexts-of-different-audit-records).</span><span class="sxs-lookup"><span data-stu-id="a8961-175">For more information, see the [Identifying the access contexts of different audit records](#identifying-the-access-contexts-of-different-audit-records) section.</span></span>

   <span data-ttu-id="a8961-176">Use as propriedades listadas abaixo para investigar.</span><span class="sxs-lookup"><span data-stu-id="a8961-176">Use the properties listed below to investigate.</span></span> <span data-ttu-id="a8961-177">Essas propriedades estão localizadas na propriedade AuditData ou OperationProperties.</span><span class="sxs-lookup"><span data-stu-id="a8961-177">These properties are located in the AuditData or OperationProperties property.</span></span> <span data-ttu-id="a8961-178">Se qualquer uma das sincronizações ocorrer no mesmo contexto da atividade do invasor, suponha que o invasor sincronizou todos os itens de email com seu cliente, o que significa que a caixa de correio inteira provavelmente foi comprometida.</span><span class="sxs-lookup"><span data-stu-id="a8961-178">If any of the syncs occur in the same context as the attacker activity, assume the attacker has synced all mail items to their client, which means the entire mailbox has probably been compromised.</span></span>

   |<span data-ttu-id="a8961-179">Propriedade</span><span class="sxs-lookup"><span data-stu-id="a8961-179">Property</span></span>         | <span data-ttu-id="a8961-180">Descrição</span><span class="sxs-lookup"><span data-stu-id="a8961-180">Description</span></span> |
   |:---------------- | :----------|
   |<span data-ttu-id="a8961-181">ClientInfoString</span><span class="sxs-lookup"><span data-stu-id="a8961-181">ClientInfoString</span></span> | <span data-ttu-id="a8961-182">Descreve protocolo, cliente (inclui versão)</span><span class="sxs-lookup"><span data-stu-id="a8961-182">Describes protocol, client (includes version)</span></span>|
   |<span data-ttu-id="a8961-183">ClientIPAddress</span><span class="sxs-lookup"><span data-stu-id="a8961-183">ClientIPAddress</span></span>  | <span data-ttu-id="a8961-184">Endereço IP do computador cliente.</span><span class="sxs-lookup"><span data-stu-id="a8961-184">IP address of the client machine.</span></span>|
   |<span data-ttu-id="a8961-185">SessionId</span><span class="sxs-lookup"><span data-stu-id="a8961-185">SessionId</span></span>        | <span data-ttu-id="a8961-186">O Session ID ajuda a diferenciar as ações do invasor versus as atividades diárias do usuário na mesma conta (no caso de uma conta comprometida)</span><span class="sxs-lookup"><span data-stu-id="a8961-186">Session ID helps to differentiate attacker actions vs day-to-day user activities on the same account (in the case of a compromised account)</span></span>|
   |<span data-ttu-id="a8961-187">UserId</span><span class="sxs-lookup"><span data-stu-id="a8961-187">UserId</span></span>           | <span data-ttu-id="a8961-188">UPN do usuário que está lendo a mensagem.</span><span class="sxs-lookup"><span data-stu-id="a8961-188">UPN of the user reading the message.</span></span>|
   |||

4. <span data-ttu-id="a8961-189">Verifique as atividades de vinculação.</span><span class="sxs-lookup"><span data-stu-id="a8961-189">Check for bind activities.</span></span> <span data-ttu-id="a8961-190">Depois de realizar as etapas 2 e 3, você pode ter certeza de que todo o acesso a mensagens de email por meio do invasor será capturado nos registros de auditoria MailItemsAccessed que têm uma propriedade MailAccessType com um valor de “Vinculação”.</span><span class="sxs-lookup"><span data-stu-id="a8961-190">After performing steps 2 and step 3, you can be confident that all other access to email messages by the attacker will be captured in the MailItemsAccessed audit records that have a MailAccessType property with a value of "Bind".</span></span>

   <span data-ttu-id="a8961-191">Para procurar registros MailItemsAccessed em que os itens de email foram acessados por uma operação de vinculação, execute o seguinte comando.</span><span class="sxs-lookup"><span data-stu-id="a8961-191">To search for MailItemsAccessed records where the mail items were accessed by a Bind operation, run the following command.</span></span>

   <span data-ttu-id="a8961-192">**Log de auditoria unificada**</span><span class="sxs-lookup"><span data-stu-id="a8961-192">**Unified audit log**</span></span>

   ```powershell
   Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000 | Where {$_.AuditData -like '*"MailAccessType","Value":"Bind"*'} | FL
   ```
 
   <span data-ttu-id="a8961-193">**Log de auditoria de caixa de correio**</span><span class="sxs-lookup"><span data-stu-id="a8961-193">**Mailbox audit log**</span></span>
   
   ```powershell
   Search-MailboxAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -Identity <user> -Operations MailItemsAccessed -ResultSize 10000 -ShowDetails | Where {$_.OperationProperties -like "*MailAccessType:Bind*"} | FL
   ```

   <span data-ttu-id="a8961-194">As mensagens de email que foram acessadas são identificadas pelo internet message Id. Você também pode verificar se algum registro de auditoria tem o mesmo contexto que o de outras atividades de invasor.</span><span class="sxs-lookup"><span data-stu-id="a8961-194">Email messages that were accessed are identified by their internet message Id. You can also check to see if any audit records have the same context as the ones for other attacker activity.</span></span> <span data-ttu-id="a8961-195">Para obter mais informações, confira a seção [Identificar os contextos de acesso de diferentes registros de auditoria](#identifying-the-access-contexts-of-different-audit-records).</span><span class="sxs-lookup"><span data-stu-id="a8961-195">For more information, see the [Identifying the access contexts of different audit records](#identifying-the-access-contexts-of-different-audit-records) section.</span></span>
 
   <span data-ttu-id="a8961-196">Você pode usar os dados de auditoria para operações de vinculação de duas maneiras diferentes:</span><span class="sxs-lookup"><span data-stu-id="a8961-196">You can use the audit data for bind operations in two different ways:</span></span>

     - <span data-ttu-id="a8961-197">Acesse ou reúna todas as mensagens de email que o invasor acessou usando o internet-message-id para encontrá-las e, em seguida, verifique se alguma dessas mensagens contém informações confidenciais.</span><span class="sxs-lookup"><span data-stu-id="a8961-197">Access or collect all email messages the attacker accessed by using the internet-message-id to find them and then checking to see if any of those messages contains sensitive information.</span></span>

     - <span data-ttu-id="a8961-198">Use o internet-message-id para procurar registros de auditoria relacionados a um conjunto de mensagens de email potencialmente confidenciais.</span><span class="sxs-lookup"><span data-stu-id="a8961-198">Use the internet-message-id to search audit records related to a set of potentially sensitive email messages.</span></span> <span data-ttu-id="a8961-199">Isso será útil se você estiver preocupado somente com uma pequena quantidade de mensagens.</span><span class="sxs-lookup"><span data-stu-id="a8961-199">This is useful if you're concerned only about a small number of messages.</span></span>

## <a name="filtering-of-duplicate-audit-records"></a><span data-ttu-id="a8961-200">Filtragem de registros de auditoria duplicados</span><span class="sxs-lookup"><span data-stu-id="a8961-200">Filtering of duplicate audit records</span></span>

<span data-ttu-id="a8961-201">Os registros de auditoria duplicados para as mesma operações de vinculação que ocorrem dentro de uma hora entre si são filtrados para remover o ruído de auditoria.</span><span class="sxs-lookup"><span data-stu-id="a8961-201">Duplicate audit records for the same bind operations that occur within an hour of each other are filtered out to remove auditing noise.</span></span> <span data-ttu-id="a8961-202">As operações de sincronização também são filtradas em intervalos de uma hora.</span><span class="sxs-lookup"><span data-stu-id="a8961-202">Sync operations are also filtered out at one-hour intervals.</span></span> <span data-ttu-id="a8961-203">A exceção para esse processo de eliminação de duplicação ocorre se, para o mesmo internet-message-id, qualquer uma das propriedades descritas na tabela a seguir for diferente.</span><span class="sxs-lookup"><span data-stu-id="a8961-203">The exception to this de-duplication process occurs if, for the same internet-message-id, any of the properties described in the following table are different.</span></span> <span data-ttu-id="a8961-204">Se uma dessas propriedades for diferente em uma operação duplicada, um novo registro de auditoria será gerado.</span><span class="sxs-lookup"><span data-stu-id="a8961-204">If one of these properties is different in a duplicate operation, a new audit record is generated.</span></span> <span data-ttu-id="a8961-205">Esse processo é descrito em mais detalhes na próxima seção.</span><span class="sxs-lookup"><span data-stu-id="a8961-205">This process is described in more detail in the next section.</span></span>

| <span data-ttu-id="a8961-206">Propriedade</span><span class="sxs-lookup"><span data-stu-id="a8961-206">Property</span></span>| <span data-ttu-id="a8961-207">Descrição</span><span class="sxs-lookup"><span data-stu-id="a8961-207">Description</span></span>|
|:--------|:---------|
|<span data-ttu-id="a8961-208">ClientIPAddress</span><span class="sxs-lookup"><span data-stu-id="a8961-208">ClientIPAddress</span></span> | <span data-ttu-id="a8961-209">O endereço IP do computador cliente.</span><span class="sxs-lookup"><span data-stu-id="a8961-209">IP address of the client computer.</span></span>|
|<span data-ttu-id="a8961-210">ClientInfoString</span><span class="sxs-lookup"><span data-stu-id="a8961-210">ClientInfoString</span></span>| <span data-ttu-id="a8961-211">O protocolo cliente, o cliente usado para acessar a caixa de correio.</span><span class="sxs-lookup"><span data-stu-id="a8961-211">The client protocol, client used to access the mailbox.</span></span>| 
|<span data-ttu-id="a8961-212">ParentFolder</span><span class="sxs-lookup"><span data-stu-id="a8961-212">ParentFolder</span></span>    | <span data-ttu-id="a8961-213">O caminho completo da pasta do item de email que foi acessado.</span><span class="sxs-lookup"><span data-stu-id="a8961-213">The full folder path of the mail item that was accessed.</span></span> |
|<span data-ttu-id="a8961-214">Logon_type</span><span class="sxs-lookup"><span data-stu-id="a8961-214">Logon_type</span></span>      | <span data-ttu-id="a8961-215">O tipo de logon do usuário que realizou a ação.</span><span class="sxs-lookup"><span data-stu-id="a8961-215">The logon type of the user who performed the action.</span></span> <span data-ttu-id="a8961-216">Os tipos de logon (e seu valor de enumeração correspondente) são Proprietário (0), Administrador (1), ou Delegado (2).</span><span class="sxs-lookup"><span data-stu-id="a8961-216">The logon types (and their corresponding Enum value) are Owner (0), Admin (1), or Delegate (2).</span></span>|
|<span data-ttu-id="a8961-217">MailAccessType</span><span class="sxs-lookup"><span data-stu-id="a8961-217">MailAccessType</span></span>  | <span data-ttu-id="a8961-218">Se o acesso é uma operação de vinculação ou de sincronização.</span><span class="sxs-lookup"><span data-stu-id="a8961-218">Whether the access is a bind or a sync operation.</span></span>|
|<span data-ttu-id="a8961-219">MailboxUPN</span><span class="sxs-lookup"><span data-stu-id="a8961-219">MailboxUPN</span></span>      | <span data-ttu-id="a8961-220">O UPN da caixa de correio na qual a mensagem que está sendo lida está localizada.</span><span class="sxs-lookup"><span data-stu-id="a8961-220">The UPN of the mailbox where the message being read is located.</span></span>|
|<span data-ttu-id="a8961-221">Usuário</span><span class="sxs-lookup"><span data-stu-id="a8961-221">User</span></span>            | <span data-ttu-id="a8961-222">O UPN do usuário lendo a mensagem.</span><span class="sxs-lookup"><span data-stu-id="a8961-222">The UPN of the user reading the message.</span></span>|
|<span data-ttu-id="a8961-223">SessionId</span><span class="sxs-lookup"><span data-stu-id="a8961-223">SessionId</span></span>       | <span data-ttu-id="a8961-224">O Session Id ajuda a diferenciar as ações do invasor e as atividades diárias do usuário na mesma caixa de correio (no caso de uma conta comprometida). Para saber mais sobre sessões, confira [Contextualizar a atividade do invasor dentro de sessões do Exchange Online](https://techcommunity.microsoft.com/t5/exchange-team-blog/contextualizing-attacker-activity-within-sessions-in-exchange/ba-p/608801).</span><span class="sxs-lookup"><span data-stu-id="a8961-224">The Session Id helps to differentiate attacker actions and day-to-day user activities in the same mailbox (in the case of account compromise) For more information about sessions, see [Contextualizing attacker activity within sessions in Exchange Online](https://techcommunity.microsoft.com/t5/exchange-team-blog/contextualizing-attacker-activity-within-sessions-in-exchange/ba-p/608801).</span></span>|
||||

## <a name="identifying-the-access-contexts-of-different-audit-records"></a><span data-ttu-id="a8961-225">Identificar os contextos de acesso de registros de auditoria diferentes</span><span class="sxs-lookup"><span data-stu-id="a8961-225">Identifying the access contexts of different audit records</span></span>

<span data-ttu-id="a8961-226">É comum que um invasor possa acessar uma caixa de correio ao mesmo tempo que o proprietário da caixa de correio está acessando.</span><span class="sxs-lookup"><span data-stu-id="a8961-226">It's common that an attacker may access a mailbox at the same time the mailbox owner is accessing it.</span></span> <span data-ttu-id="a8961-227">Para diferenciar o acesso do invasor do acesso do proprietário da caixa de correio, há propriedades de registro de auditoria que definem o contexto do acesso.</span><span class="sxs-lookup"><span data-stu-id="a8961-227">To differentiate between access by the attacker and the mailbox owner, there are audit record properties that define the context of the access.</span></span> <span data-ttu-id="a8961-228">Como explicado anteriormente, quando os valores dessas propriedades forem diferentes, mesmo quando a atividade ocorrer dentro do intervalo de agregação, os registros de auditoria separados serão gerados.</span><span class="sxs-lookup"><span data-stu-id="a8961-228">As previously explained, when the values for these properties are different, even when the activity occurs within the aggregation interval, separate audit records are generated.</span></span> <span data-ttu-id="a8961-229">No exemplo a seguir, há três registros de auditoria diferentes.</span><span class="sxs-lookup"><span data-stu-id="a8961-229">In the following example, there are three different audit records.</span></span> <span data-ttu-id="a8961-230">Cada um é diferenciado pelas propriedades Session Id e ClientIPAddress.</span><span class="sxs-lookup"><span data-stu-id="a8961-230">Each one is differentiated by the Session Id and ClientIPAddress properties.</span></span> <span data-ttu-id="a8961-231">As mensagens que foram acessadas também são identificadas.</span><span class="sxs-lookup"><span data-stu-id="a8961-231">The messages that were accessed are also identified.</span></span>

|<span data-ttu-id="a8961-232">Registro de auditoria 1</span><span class="sxs-lookup"><span data-stu-id="a8961-232">Audit record 1</span></span>  |<span data-ttu-id="a8961-233">Registro de auditoria 2</span><span class="sxs-lookup"><span data-stu-id="a8961-233">Audit record 2</span></span>  |<span data-ttu-id="a8961-234">Registro de auditoria 3</span><span class="sxs-lookup"><span data-stu-id="a8961-234">Audit record 3</span></span>|
|---------|---------|---------|
|<span data-ttu-id="a8961-235">ClientIPAddress**1**</span><span class="sxs-lookup"><span data-stu-id="a8961-235">ClientIPAddress**1**</span></span><br/><span data-ttu-id="a8961-236">SessionId**2**</span><span class="sxs-lookup"><span data-stu-id="a8961-236">SessionId**2**</span></span>|<span data-ttu-id="a8961-237">ClientIPAddress**2**</span><span class="sxs-lookup"><span data-stu-id="a8961-237">ClientIPAddress**2**</span></span><br/><span data-ttu-id="a8961-238">SessionId**2**</span><span class="sxs-lookup"><span data-stu-id="a8961-238">SessionId**2**</span></span>|<span data-ttu-id="a8961-239">ClientIPAddress**1**</span><span class="sxs-lookup"><span data-stu-id="a8961-239">ClientIPAddress**1**</span></span><br/><span data-ttu-id="a8961-240">SessionId**3**</span><span class="sxs-lookup"><span data-stu-id="a8961-240">SessionId**3**</span></span>|
|<span data-ttu-id="a8961-241">InternetMessageId**A**</span><span class="sxs-lookup"><span data-stu-id="a8961-241">InternetMessageId**A**</span></span><br/><span data-ttu-id="a8961-242">InternetMessageId**D**</span><span class="sxs-lookup"><span data-stu-id="a8961-242">InternetMessageId**D**</span></span><br/><span data-ttu-id="a8961-243">InternetMessageId**E**</span><span class="sxs-lookup"><span data-stu-id="a8961-243">InternetMessageId**E**</span></span><br/><span data-ttu-id="a8961-244">InternetMessageId**F**</span><span class="sxs-lookup"><span data-stu-id="a8961-244">InternetMessageId**F**</span></span><br/>|<span data-ttu-id="a8961-245">InternetMessageId**A**</span><span class="sxs-lookup"><span data-stu-id="a8961-245">InternetMessageId**A**</span></span><br/><span data-ttu-id="a8961-246">InternetMessageId**C**</span><span class="sxs-lookup"><span data-stu-id="a8961-246">InternetMessageId**C**</span></span>|<span data-ttu-id="a8961-247">InternetMessageId**B**</span><span class="sxs-lookup"><span data-stu-id="a8961-247">InternetMessageId**B**</span></span> |
||||

<span data-ttu-id="a8961-248">Se alguma das propriedades listadas na tabela na [seção anterior](#filtering-of-duplicate-audit-records) forem diferentes, um registro de auditoria separado será gerado para controlar o novo contexto.</span><span class="sxs-lookup"><span data-stu-id="a8961-248">If any of the properties listed in the table in the [previous section](#filtering-of-duplicate-audit-records) are different, a separate audit record is generated to track the new context.</span></span> <span data-ttu-id="a8961-249">Os acessos serão classificados nos registros de auditoria separados, dependendo do contexto em que a atividade ocorreu.</span><span class="sxs-lookup"><span data-stu-id="a8961-249">Accesses will be sorted into the separate audit records depending on the context in which the activity took place.</span></span>

<span data-ttu-id="a8961-250">Por exemplo, em registros de auditoria mostrados na captura de tela a seguir, embora estejamos acessando o email do EWSEditor e OWA simultaneamente, a atividade de acesso é agrupada em registros de auditoria diferentes, dependendo do contexto no qual o acesso ocorreu.</span><span class="sxs-lookup"><span data-stu-id="a8961-250">For example, in audit records shown in the following screenshot, though we are accessing mail from EWSEditor and OWA simultaneously, the access activity is collated in different audit records depending on the context in which the access took place.</span></span> <span data-ttu-id="a8961-251">Neste caso, o contexto é definido pelo valores diferentes para a propriedade ClientInfoString.</span><span class="sxs-lookup"><span data-stu-id="a8961-251">In this case, the context is defined by different values for the ClientInfoString property.</span></span>

![Registros de auditoria diferentes com base em contexto](../media/MailItemsAccessed4.png)
