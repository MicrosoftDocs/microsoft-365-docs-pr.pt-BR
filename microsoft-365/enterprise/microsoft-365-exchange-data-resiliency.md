---
title: Resiliência de dados do Exchange Online no Microsoft 365
ms.author: josephd
author: JoeDavies-MSFT
manager: laurawi
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
f1.keywords:
- NOCSH
description: Neste artigo, encontre uma explicação dos vários aspectos da resiliência de dados no Exchange Online e no Microsoft 365.
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: dfc53fd48a6de61cf47a0441cd2f8b0fa35a73f1
ms.sourcegitcommit: 79065e72c0799064e9055022393113dfcf40eb4b
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/14/2020
ms.locfileid: "46695342"
---
# <a name="exchange-online-data-resiliency-in-microsoft-365"></a><span data-ttu-id="a6183-103">Resiliência de dados do Exchange Online no Microsoft 365</span><span class="sxs-lookup"><span data-stu-id="a6183-103">Exchange Online Data Resiliency in Microsoft 365</span></span>

<span data-ttu-id="a6183-104">Há dois tipos de danos que podem afetar um banco de dados do Exchange: corrupção física, que normalmente é causado por problemas de hardware (em particular, hardware de armazenamento) e danos lógicos, que ocorre devido a outros fatores.</span><span class="sxs-lookup"><span data-stu-id="a6183-104">There are two types of corruption that can affect an Exchange database: physical corruption, which is typically caused by hardware (in particular, storage hardware) problems, and logical corruption, which occurs due to other factors.</span></span> <span data-ttu-id="a6183-105">Geralmente, há dois tipos de corrupção lógica que podem ocorrer em um banco de dados do Exchange:</span><span class="sxs-lookup"><span data-stu-id="a6183-105">Generally, there are two types of logical corruption that can occur within an Exchange database:</span></span> 
- <span data-ttu-id="a6183-106">**Corrupção lógica do banco** de dados-o checksum da página do banco de dados corresponde, mas os dados na página estão errados de forma lógica.</span><span class="sxs-lookup"><span data-stu-id="a6183-106">**Database logical corruption** - The database page checksum matches, but the data on the page is wrong logically.</span></span> <span data-ttu-id="a6183-107">Isso pode ocorrer quando o mecanismo de banco de dados (o mecanismo de armazenamento extensível (ESE) tenta gravar uma página de banco de dados e, embora o sistema operacional retorne uma mensagem de êxito, os dados nunca são gravados no disco ou gravados no lugar errado.</span><span class="sxs-lookup"><span data-stu-id="a6183-107">This can occur when the database engine (the Extensible Storage Engine (ESE)) attempts to write a database page and even though the operating system returns a success message, the data is either never written to the disk or it's written to the wrong place.</span></span> <span data-ttu-id="a6183-108">Isso é conhecido como *liberação perdida*.</span><span class="sxs-lookup"><span data-stu-id="a6183-108">This is referred to as a *lost flush*.</span></span> <span data-ttu-id="a6183-109">O ESE inclui vários recursos e proteções projetadas para impedir a corrupção física de um banco de dados e outros cenários de perda de dados.</span><span class="sxs-lookup"><span data-stu-id="a6183-109">ESE includes numerous features and safeguards that are designed to prevent physical corruption of a database and other data loss scenarios.</span></span> <span data-ttu-id="a6183-110">Para evitar que as liberações perdidas percam dados, o ESE inclui um mecanismo de detecção de liberação perdido no banco de dados, juntamente com um recurso (restauração de página única) para corrigi-lo.</span><span class="sxs-lookup"><span data-stu-id="a6183-110">To prevent lost flushes from losing data, ESE includes a lost flush detection mechanism in the database along with a feature (single page restore) to correct it.</span></span> 
- <span data-ttu-id="a6183-111">**Corrupção lógica de armazenamento** -os dados são adicionados, excluídos ou manipulados de forma que o usuário não espera.</span><span class="sxs-lookup"><span data-stu-id="a6183-111">**Store logical corruption** - Data is added, deleted, or manipulated in a way that the user doesn't expect.</span></span> <span data-ttu-id="a6183-112">Esses casos normalmente são causados por aplicativos de terceiros.</span><span class="sxs-lookup"><span data-stu-id="a6183-112">These cases are generally caused by third-party applications.</span></span> <span data-ttu-id="a6183-113">Ele normalmente é apenas um dano no sentido em que o usuário o considera assim.</span><span class="sxs-lookup"><span data-stu-id="a6183-113">It's generally only corruption in the sense that the user views it as corruption.</span></span> <span data-ttu-id="a6183-114">O repositório do Exchange considera a transação que produziu o dano lógico uma série de operações MAPI válidas.</span><span class="sxs-lookup"><span data-stu-id="a6183-114">The Exchange store considers the transaction that produced the logical corruption to be a series of valid MAPI operations.</span></span> <span data-ttu-id="a6183-115">Os recursos de [bloqueio in-loco](https://docs.microsoft.com/exchange/security-and-compliance/create-or-remove-in-place-holds) no Exchange Online oferecem proteção contra corrupção lógica de armazenamento (porque impede que o conteúdo seja excluído permanentemente por um usuário ou um aplicativo).</span><span class="sxs-lookup"><span data-stu-id="a6183-115">The [In-Place Hold](https://docs.microsoft.com/exchange/security-and-compliance/create-or-remove-in-place-holds) features in Exchange Online provides protection from store logical corruption (because it prevents content from being permanently deleted by a user or an application).</span></span> 

<span data-ttu-id="a6183-116">O Exchange Online executa várias verificações de consistência em arquivos de log replicados durante a inspeção de logs e a repetição de log.</span><span class="sxs-lookup"><span data-stu-id="a6183-116">Exchange Online performs several consistency checks on replicated log files during both log inspection and log replay.</span></span> <span data-ttu-id="a6183-117">Essas verificações de consistência impedem que a corrupção física seja replicada pelo sistema.</span><span class="sxs-lookup"><span data-stu-id="a6183-117">These consistency checks prevent physical corruption from being replicated by the system.</span></span> <span data-ttu-id="a6183-118">Por exemplo, durante a inspeção do log, há uma verificação de integridade física que verifica o arquivo de log e valida que a soma de verificação registrada no arquivo de log corresponde à soma de verificação gerada na memória.</span><span class="sxs-lookup"><span data-stu-id="a6183-118">For example, during log inspection, there is a physical integrity check which verifies the log file and validates that the checksum recorded in the log file matches the checksum generated in memory.</span></span> <span data-ttu-id="a6183-119">Além disso, o cabeçalho do arquivo de log é examinado para garantir que a assinatura do arquivo de log registrada no cabeçalho do log corresponda à do arquivo de log.</span><span class="sxs-lookup"><span data-stu-id="a6183-119">In addition, the log file header is examined to make sure the log file signature recorded in the log header matches that of the log file.</span></span> <span data-ttu-id="a6183-120">Durante a repetição de log, o arquivo de log fica em uma análise mais detalhada.</span><span class="sxs-lookup"><span data-stu-id="a6183-120">During log replay, the log file undergoes further scrutiny.</span></span> <span data-ttu-id="a6183-121">Por exemplo, o cabeçalho do banco de dados também contém a assinatura de log que é comparada com a assinatura do arquivo de log para garantir que eles correspondam.</span><span class="sxs-lookup"><span data-stu-id="a6183-121">For example, the database header also contains the log signature which is compared with the log file's signature to ensure they match.</span></span> 

<span data-ttu-id="a6183-122">A proteção contra a corrupção dos dados de caixa de correio no Exchange Online é obtida usando a proteção de dados nativa do Exchange, uma estratégia de resiliência que aproveita a replicação de nível de aplicativo em vários servidores e vários datacenters, juntamente com outros recursos que ajudam a proteger os dados contra a perda ou outros motivos.</span><span class="sxs-lookup"><span data-stu-id="a6183-122">Protection against corruption of mailbox data in Exchange Online is achieved by using Exchange Native Data Protection, a resiliency strategy that leverages application-level replication across multiple servers and multiple datacenters along with other features that help protect data from being lost due to corruption or other reasons.</span></span> <span data-ttu-id="a6183-123">Esses recursos incluem recursos nativos que são gerenciados pela Microsoft ou pelo próprio aplicativo Exchange Online, como:</span><span class="sxs-lookup"><span data-stu-id="a6183-123">These features include native features that are managed by Microsoft or the Exchange Online application itself, such as:</span></span>

- [<span data-ttu-id="a6183-124">Grupos de disponibilidade de dados</span><span class="sxs-lookup"><span data-stu-id="a6183-124">Data Availability Groups</span></span>](https://docs.microsoft.com/exchange/back-up-email)
- <span data-ttu-id="a6183-125">Correção de bit único</span><span class="sxs-lookup"><span data-stu-id="a6183-125">Single Bit Correction</span></span> 
- <span data-ttu-id="a6183-126">Verificação de banco de dados online</span><span class="sxs-lookup"><span data-stu-id="a6183-126">Online Database Scanning</span></span> 
- <span data-ttu-id="a6183-127">Detecção de liberação perdida</span><span class="sxs-lookup"><span data-stu-id="a6183-127">Lost Flush Detection</span></span> 
- <span data-ttu-id="a6183-128">Restauração de página única</span><span class="sxs-lookup"><span data-stu-id="a6183-128">Single Page Restore</span></span> 
- <span data-ttu-id="a6183-129">Serviço de replicação de caixa de correio</span><span class="sxs-lookup"><span data-stu-id="a6183-129">Mailbox Replication Service</span></span> 
- <span data-ttu-id="a6183-130">Verificações de arquivo de log</span><span class="sxs-lookup"><span data-stu-id="a6183-130">Log File Checks</span></span> 
- <span data-ttu-id="a6183-131">Implantação no sistema de arquivos resiliente</span><span class="sxs-lookup"><span data-stu-id="a6183-131">Deployment on Resilient File System</span></span> 

<span data-ttu-id="a6183-132">Para obter mais informações sobre os recursos nativos listados acima, clique nos hiperlinks acima e veja a seguir as informações adicionais e para obter detalhes sobre os itens sem hiperlinks.</span><span class="sxs-lookup"><span data-stu-id="a6183-132">For more information on the native features listed above, click on the above hyperlinks, and see below for additional information and for details on items without hyperlinks.</span></span> <span data-ttu-id="a6183-133">Além desses recursos nativos, o Exchange Online também inclui recursos de resiliência de dados que os clientes podem gerenciar, como:</span><span class="sxs-lookup"><span data-stu-id="a6183-133">In addition to these native features, Exchange Online also includes data resiliency features that customers can manage, such as:</span></span> 
- [<span data-ttu-id="a6183-134">Recuperação de item único (habilitada por padrão)</span><span class="sxs-lookup"><span data-stu-id="a6183-134">Single Item Recovery (enabled by default)</span></span>](https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/recover-deleted-messages) 
- [<span data-ttu-id="a6183-135">Bloqueio In-loco e Retenção de Litígio</span><span class="sxs-lookup"><span data-stu-id="a6183-135">In-Place Hold and Litigation Hold</span></span>](https://docs.microsoft.com/exchange/security-and-compliance/in-place-and-litigation-holds) 
- [<span data-ttu-id="a6183-136">Retenção de item excluído e caixas de correio excluídas por software (habilitadas por padrão)</span><span class="sxs-lookup"><span data-stu-id="a6183-136">Deleted Item Retention and Soft-Deleted Mailboxes (both enabled by default)</span></span>](https://docs.microsoft.com/exchange/recipients-in-exchange-online/delete-or-restore-mailboxes) 

## <a name="database-availability-groups"></a><span data-ttu-id="a6183-137">Grupos de disponibilidade de banco de dados</span><span class="sxs-lookup"><span data-stu-id="a6183-137">Database Availability Groups</span></span> 
<span data-ttu-id="a6183-138">Cada banco de dados de caixa de correio no Microsoft 365 é hospedado em um [grupo de disponibilidade de banco de dados (DAG)](https://docs.microsoft.com/exchange/back-up-email) e replicado para datacenters separados geograficamente dentro da mesma região.</span><span class="sxs-lookup"><span data-stu-id="a6183-138">Every mailbox database in Microsoft 365 is hosted in a [database availability group (DAG)](https://docs.microsoft.com/exchange/back-up-email) and replicated to geographically-separate datacenters within the same region.</span></span> <span data-ttu-id="a6183-139">A configuração mais comum é de quatro cópias de banco de dados em quatro data centers; no entanto, algumas regiões têm menos datacenters (bancos de dados são replicados para três data centers na Índia e dois datacenters na Austrália e no Japão).</span><span class="sxs-lookup"><span data-stu-id="a6183-139">The most common configuration is four database copies in four datacenters; however, some regions have fewer datacenters (databases are replicated to three datacenters in India, and two datacenters in Australia and Japan).</span></span> <span data-ttu-id="a6183-140">Mas em todos os casos, cada banco de dados de caixa de correio tem quatro cópias que são distribuídas por vários datacenters, garantindo que os dados da caixa de correio estejam protegidos de software, hardware e até mesmo falhas de datacenter.</span><span class="sxs-lookup"><span data-stu-id="a6183-140">But in all cases, every mailbox database has four copies that are distributed across multiple datacenters, thereby ensuring that mailbox data is protected from software, hardware, and even datacenter failures.</span></span> 

<span data-ttu-id="a6183-141">Dessas quatro cópias, três delas são configuradas como altamente disponíveis.</span><span class="sxs-lookup"><span data-stu-id="a6183-141">Out of these four copies, three of them are configured as highly available.</span></span> <span data-ttu-id="a6183-142">A quarta cópia é configurada como uma [cópia de banco de dados](https://docs.microsoft.com/Exchange/high-availability/manage-ha/activate-lagged-db-copies)com retardamento.</span><span class="sxs-lookup"><span data-stu-id="a6183-142">The fourth copy is configured as a [lagged database copy](https://docs.microsoft.com/Exchange/high-availability/manage-ha/activate-lagged-db-copies).</span></span> <span data-ttu-id="a6183-143">A cópia de banco de dados com retardamento não se destina a recuperação de caixa de correio ou de caixa de correio individual.</span><span class="sxs-lookup"><span data-stu-id="a6183-143">The lagged database copy is not intended for individual mailbox recovery or mailbox item recovery.</span></span> <span data-ttu-id="a6183-144">Sua finalidade é fornecer um mecanismo de recuperação para o raro evento de danos lógicos catastróficos em todo o sistema.</span><span class="sxs-lookup"><span data-stu-id="a6183-144">Its purpose is to provide a recovery mechanism for the rare event of system-wide, catastrophic logical corruption.</span></span> 

<span data-ttu-id="a6183-145">Cópias de banco de dados com retardamento no Exchange Online são configuradas com um tempo de retardo de repetição de um arquivo de log de sete dias.</span><span class="sxs-lookup"><span data-stu-id="a6183-145">Lagged database copies in Exchange Online are configured with a seven-day log file replay lag time.</span></span> <span data-ttu-id="a6183-146">Além disso, o Gerenciador de retardo de repetição do Exchange é habilitado para fornecer um arquivo de log dinâmico, que é executado para cópias com retardamento para permitir que cópias de bancos de dados com o autoreparo e gerenciar o aumento do arquivo de log</span><span class="sxs-lookup"><span data-stu-id="a6183-146">In addition, the Exchange Replay Lag Manager is enabled to provide dynamic log file play down for lagged copies to allow lagged database copies to self-repair and manage log file growth.</span></span> <span data-ttu-id="a6183-147">Embora as cópias de banco de dados com retardamento sejam usadas no Exchange Online, é importante entender que elas não são um backup point-in-time garantido.</span><span class="sxs-lookup"><span data-stu-id="a6183-147">Although lagged database copies are used in Exchange Online, it is important to understand that they are not a guaranteed point-in-time backup.</span></span> <span data-ttu-id="a6183-148">Cópias de banco de dados com retardamento no Exchange Online têm um limite de disponibilidade, geralmente em torno de 90%, devido a pontos em que o disco que contém uma cópia com retardamento é perdido devido à falha de disco, a cópia com retardamento se torna uma cópia altamente disponível (devido à execução automática), bem como aos períodos em que a cópia de banco de dados com atraso é</span><span class="sxs-lookup"><span data-stu-id="a6183-148">Lagged database copies in Exchange Online have an availability threshold, typically around 90%, due to periods where the disk containing a lagged copy is lost due to disk failure, the lagged copy becoming a highly-available copy (due to automatic play down), as well as the periods where the lagged database copy is re-building the log replay queue.</span></span> 

## <a name="transport-resilience"></a><span data-ttu-id="a6183-149">Resiliência de transporte</span><span class="sxs-lookup"><span data-stu-id="a6183-149">Transport Resilience</span></span> 
<span data-ttu-id="a6183-150">O Exchange Online inclui dois recursos de resiliência de transporte primários: redundância de sombra e rede de segurança.</span><span class="sxs-lookup"><span data-stu-id="a6183-150">Exchange Online includes two primary transport resilience features: Shadow Redundancy and Safety Net.</span></span> <span data-ttu-id="a6183-151">A redundância de sombra mantém uma cópia redundante de uma mensagem enquanto está em trânsito.</span><span class="sxs-lookup"><span data-stu-id="a6183-151">Shadow Redundancy keeps a redundant copy of a message while it is in transit.</span></span> <span data-ttu-id="a6183-152">A rede segura mantém uma cópia redundante de uma mensagem após a mensagem ser entregue com êxito.</span><span class="sxs-lookup"><span data-stu-id="a6183-152">Safety Net keeps a redundant copy of a message after the message is successfully delivered.</span></span> 

<span data-ttu-id="a6183-153">Com a redundância de sombra, cada servidor de transporte do Exchange Online faz uma cópia de cada mensagem que recebe antes de confirmar a recepção bem-sucedida da mensagem ao servidor de envio.</span><span class="sxs-lookup"><span data-stu-id="a6183-153">With Shadow Redundancy, each Exchange Online transport server makes a copy of each message it receives before it acknowledges successfully receiving the message to the sending server.</span></span> <span data-ttu-id="a6183-154">Isso torna as mensagens no pipeline de transporte redundantes enquanto estão em trânsito.</span><span class="sxs-lookup"><span data-stu-id="a6183-154">This makes all messages in the transport pipeline redundant while in transit.</span></span> <span data-ttu-id="a6183-155">Se o Exchange Online determinar que a mensagem original foi perdida no trânsito, uma cópia redundante da mensagem será entregue novamente.</span><span class="sxs-lookup"><span data-stu-id="a6183-155">If Exchange Online determines the original message was lost in transit, a redundant copy of the message is redelivered.</span></span> 

<span data-ttu-id="a6183-156">A rede segura é uma fila de transporte associada ao serviço de transporte em um servidor de caixa de correio.</span><span class="sxs-lookup"><span data-stu-id="a6183-156">Safety Net is a transport queue that is associated with the Transport service on a Mailbox server.</span></span> <span data-ttu-id="a6183-157">Esta fila armazena cópias de mensagens que foram processadas com êxito pelo servidor.</span><span class="sxs-lookup"><span data-stu-id="a6183-157">This queue stores copies of messages that were successfully processed by the server.</span></span> <span data-ttu-id="a6183-158">Quando um banco de dados de caixa de correio ou de servidor requer a ativação de uma cópia desatualizada do banco de dados de caixa de correio, as mensagens na fila da rede de segurança são reenviadas automaticamente para a nova cópia ativa do banco de dados de caixa de correio.</span><span class="sxs-lookup"><span data-stu-id="a6183-158">When a mailbox database or server failure requires activating an out-of-date copy of the mailbox database, messages in the Safety Net queue are automatically resubmitted to the new active copy of the mailbox database.</span></span> <span data-ttu-id="a6183-159">A rede segura também é redundante, eliminando assim o transporte como um único ponto de falha.</span><span class="sxs-lookup"><span data-stu-id="a6183-159">Safety Net is also redundant, thereby eliminating transport as a single point of failure.</span></span> <span data-ttu-id="a6183-160">Ele usa o conceito de uma rede de segurança principal e uma rede de segurança de sombra em que se a rede de segurança principal não estiver disponível por mais de 12 horas, as solicitações de reenvio se tornarão as solicitações de reenvio de sombra e as mensagens são reenviadas da rede de segurança de sombra.</span><span class="sxs-lookup"><span data-stu-id="a6183-160">It uses the concept of a Primary Safety Net and a Shadow Safety Net wherein if the Primary Safety Net is unavailable for more than 12 hours, resubmit requests become shadow resubmit requests, and messages are re-delivered from the Shadow Safety Net.</span></span>

<span data-ttu-id="a6183-161">Os reenvios de mensagem da rede de segurança são iniciados automaticamente pelo componente Gerenciador ativo do serviço de replicação do Microsoft Exchange que gerencia as cópias de banco de dados de DAGs e de caixa de correio.</span><span class="sxs-lookup"><span data-stu-id="a6183-161">Message resubmissions from Safety Net are automatically initiated by the Active Manager component of the Microsoft Exchange Replication service that manages DAGs and mailbox database copies.</span></span> <span data-ttu-id="a6183-162">Nenhuma ação manual é necessária para reenviar mensagens da rede de segurança.</span><span class="sxs-lookup"><span data-stu-id="a6183-162">No manual actions are required to resubmit messages from Safety Net.</span></span> 

## <a name="single-bit-correction"></a><span data-ttu-id="a6183-163">Correção de bit único</span><span class="sxs-lookup"><span data-stu-id="a6183-163">Single Bit Correction</span></span> 
<span data-ttu-id="a6183-164">O ESE inclui um mecanismo para detectar e resolver erros de CRC de um único bit (conhecidos como inversão de bit único) que são o resultado de erros de hardware (e, como eles representam corrupção física).</span><span class="sxs-lookup"><span data-stu-id="a6183-164">ESE includes a mechanism to detect and resolve single-bit CRC errors (aka single-bit flips) that are the result of hardware errors (and as such they represent physical corruption).</span></span> <span data-ttu-id="a6183-165">Quando esses erros ocorrem, o ESE os corrige automaticamente e registra um evento no log de eventos.</span><span class="sxs-lookup"><span data-stu-id="a6183-165">When these errors occur, ESE automatically corrects them and logs an event in the event log.</span></span> 

## <a name="online-database-scanning"></a><span data-ttu-id="a6183-166">Verificação de banco de dados online</span><span class="sxs-lookup"><span data-stu-id="a6183-166">Online Database Scanning</span></span> 
<span data-ttu-id="a6183-167">A verificação de banco de dados online (também conhecida como soma de verificação de *banco*de dados) é o processo em que um ESE usa um verificador de consistência de banco de dados para ler cada página e verificar a corrupção da página</span><span class="sxs-lookup"><span data-stu-id="a6183-167">Online database scanning (also known as *database checksumming*) is the process where an ESE uses a database consistency checker to read each page and check for page corruption.</span></span> <span data-ttu-id="a6183-168">O objetivo principal é detectar corrupção física e liberações perdidas que podem não ser detectadas por operações transacionais.</span><span class="sxs-lookup"><span data-stu-id="a6183-168">The primary purpose is to detect physical corruption and lost flushes that may not be getting detected by transactional operations.</span></span> <span data-ttu-id="a6183-169">A verificação de banco de dados também realiza operações de falha no post-Store.</span><span class="sxs-lookup"><span data-stu-id="a6183-169">Database scanning also performs post-store crash operations.</span></span> <span data-ttu-id="a6183-170">O espaço pode ser vazado devido a falhas, e a verificação de banco de dados online localiza e recupera o espaço perdido.</span><span class="sxs-lookup"><span data-stu-id="a6183-170">Space can be leaked due to crashes, and online database scanning finds and recovers lost space.</span></span> <span data-ttu-id="a6183-171">O sistema é projetado com a expectativa de que todos os bancos de dados sejam totalmente verificados uma vez a cada sete dias.</span><span class="sxs-lookup"><span data-stu-id="a6183-171">The system is designed with the expectation that every database is fully scanned once every seven days.</span></span> 

## <a name="lost-flush-detection"></a><span data-ttu-id="a6183-172">Detecção de liberação perdida</span><span class="sxs-lookup"><span data-stu-id="a6183-172">Lost Flush Detection</span></span> 
<span data-ttu-id="a6183-173">Uma liberação perdida ocorre quando uma operação de gravação de banco de dados que o subsistema de disco/sistema operacional retornou como concluído não foi realmente gravada no disco ou foi gravada no local errado.</span><span class="sxs-lookup"><span data-stu-id="a6183-173">A lost flush occurs when a database write operation that the disk subsystem/operating system returned as completed did not actually get written to disk, or was written in the wrong location.</span></span> <span data-ttu-id="a6183-174">Os incidentes de liberação perdidos podem resultar em corrupção lógica do banco de dados, portanto, para evitar que as liberações perdidas resultem em perda de dados, o ESE inclui um mecanismo de detecção de liberação perdido.</span><span class="sxs-lookup"><span data-stu-id="a6183-174">Lost flush incidents can result in database logical corruption, so to prevent lost flushes from resulting in lost data, ESE includes a lost flush detection mechanism.</span></span> <span data-ttu-id="a6183-175">Como as páginas do banco de dados são gravadas em cópias passivas, uma verificação é realizada para liberações perdidas na cópia ativa.</span><span class="sxs-lookup"><span data-stu-id="a6183-175">As database pages are written to passive copies, a check is performed for lost flushes on the active copy.</span></span> <span data-ttu-id="a6183-176">Se uma liberação perdida for detectada, o ESE poderá reparar o processo usando um processo de aplicação de patch de página.</span><span class="sxs-lookup"><span data-stu-id="a6183-176">If a lost flush is detected, ESE can repair the process using a page patching process.</span></span> 

## <a name="single-page-restore"></a><span data-ttu-id="a6183-177">Restauração de página única</span><span class="sxs-lookup"><span data-stu-id="a6183-177">Single Page Restore</span></span> 
<span data-ttu-id="a6183-178">Restauração de página única, aka a *correção de página*, é um processo automático onde as páginas de banco de dados corrompidas são substituídas por cópias saudáveis de uma réplica íntegra.</span><span class="sxs-lookup"><span data-stu-id="a6183-178">Single page restore, aka *page patching*, is an automatic process where corrupt database pages are replaced by healthy copies from a healthy replica.</span></span> <span data-ttu-id="a6183-179">O processo de reparo para uma página corrompida depende se a cópia do banco de dados está ativa ou passiva.</span><span class="sxs-lookup"><span data-stu-id="a6183-179">The repair process for a corrupt page depends on whether the database copy is active or passive.</span></span> <span data-ttu-id="a6183-180">Quando uma cópia de banco de dados ativa encontra uma página corrompida, ela pode copiar uma página de uma de suas réplicas, desde que a página que ele copia esteja totalmente atualizada.</span><span class="sxs-lookup"><span data-stu-id="a6183-180">When an active database copy encounters a corrupted page, it can copy a page from one of its replicas, provided the page it copies is completely up-to-date.</span></span> <span data-ttu-id="a6183-181">Isso é feito colocando uma solicitação para a página no fluxo de log, que é a base da replicação de banco de dados de caixa de correio.</span><span class="sxs-lookup"><span data-stu-id="a6183-181">This is accomplished by putting a request for the page into the log stream, which is the basis of mailbox database replication.</span></span> <span data-ttu-id="a6183-182">Assim que uma réplica encontra a solicitação de página que responde enviando uma cópia da página para a cópia do banco de dados solicitante.</span><span class="sxs-lookup"><span data-stu-id="a6183-182">As soon as a replica encounters the page request it responds by sending a copy of the page to the requesting database copy.</span></span> <span data-ttu-id="a6183-183">A restauração de página única também fornece um mecanismo de comunicação assíncrono para que o Active solicite uma página de réplicas, mesmo que as réplicas estejam offline no momento.</span><span class="sxs-lookup"><span data-stu-id="a6183-183">Single page restore also provides an asynchronous communication mechanism for the active to request a page from replicas, even if the replicas are currently offline.</span></span> 

<span data-ttu-id="a6183-184">No caso de corrupção em uma cópia de banco de dados passiva, incluindo uma cópia de banco de dados com retardamento, pois essas cópias estão sempre atrás de sua cópia ativa, é sempre seguro copiar qualquer página da cópia ativa para uma cópia passiva.</span><span class="sxs-lookup"><span data-stu-id="a6183-184">In case of corruption in a passive database copy, including a lagged database copy, because these copies are always behind their active copy, it is always safe to copy any page from the active copy to a passive copy.</span></span> <span data-ttu-id="a6183-185">Uma cópia de banco de dados passiva é por natureza altamente disponível, portanto, durante o processo de correção de página, a repetição de log é suspensa, mas a cópia de log continua.</span><span class="sxs-lookup"><span data-stu-id="a6183-185">A passive database copy is by nature highly available, so during the page patching process, log replaying is suspended, but log copying continues.</span></span> <span data-ttu-id="a6183-186">A cópia de banco de dados passiva recupera uma cópia da página corrompida da cópia ativa, aguarda até que o arquivo de log que atenda ao requisito de geração de log máximo necessário seja copiado e inspecionado e, em seguida, correção a página corrompida.</span><span class="sxs-lookup"><span data-stu-id="a6183-186">The passive database copy retrieves a copy of the corrupted page from the active copy, waits until the log file which meets the maximum required log generation requirement is copied and inspected, and then patches the corrupt page.</span></span> <span data-ttu-id="a6183-187">Depois que a página for corrigida, a repetição de log será retomada.</span><span class="sxs-lookup"><span data-stu-id="a6183-187">Once the page has been patched, log replay resumes.</span></span> <span data-ttu-id="a6183-188">O processo é o mesmo para a cópia de banco de dados com atraso, exceto pelo fato de que o banco de dados com atraso primeiro repete todos os arquivos de log necessários para obter um estado de patch.</span><span class="sxs-lookup"><span data-stu-id="a6183-188">The process is the same for the lagged database copy, except that the lagged database first replays all log files that are necessary to achieve a patchable state.</span></span> 

## <a name="mailbox-replication-service"></a><span data-ttu-id="a6183-189">Serviço de replicação de caixa de correio</span><span class="sxs-lookup"><span data-stu-id="a6183-189">Mailbox Replication Service</span></span> 
<span data-ttu-id="a6183-190">A movimentação de caixas de correio é uma parte fundamental do gerenciamento de um serviço de email em larga escala.</span><span class="sxs-lookup"><span data-stu-id="a6183-190">Moving mailboxes is a key part of managing a large-scale email service.</span></span> <span data-ttu-id="a6183-191">Há sempre tecnologias atualizadas e atualizações de hardware e versão para lidar com o, portanto, ter um sistema acelerado e robusto que permite que nossos engenheiros realizem esse trabalho e, ao mesmo tempo, mantém a caixa de correio transparente para os usuários (garantindo que eles permaneçam online ao longo do processo) é fundamental e garantir que o processo seja dimensionado com mais eficiência quando as caixas de correio</span><span class="sxs-lookup"><span data-stu-id="a6183-191">There are always updated technologies and hardware and version upgrades to deal with, so having a robust, throttled system that enables our engineers to accomplish this work while keeping the mailbox moves transparent to users (by making sure they stay online throughout the process) is key and making sure that the process scales up gracefully as mailboxes get larger and larger.</span></span> 

<span data-ttu-id="a6183-192">O serviço de replicação de caixa de correio do Exchange (Sra) é responsável por mover caixas de correio entre bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="a6183-192">The Exchange Mailbox Replication Service (MRS) is responsible for moving mailboxes between databases.</span></span> <span data-ttu-id="a6183-193">Durante a movimentação, a Sra executa uma verificação de consistência em todos os itens da caixa de correio.</span><span class="sxs-lookup"><span data-stu-id="a6183-193">During the move, MRS performs a consistency check on all items within the mailbox.</span></span> <span data-ttu-id="a6183-194">Se for encontrado um problema de consistência, o Sra corrigirá o problema ou ignorará os itens corrompidos, removendo assim os danos da caixa de correio.</span><span class="sxs-lookup"><span data-stu-id="a6183-194">If a consistency issue is found, MRS will either correct the problem, or skip the corrupted items, thereby removing the corruption from the mailbox.</span></span> 

<span data-ttu-id="a6183-195">Como o Sra é um componente do Exchange Online, podemos fazer alterações em seu código para tratar de novas formas de danos que foram detectadas no futuro.</span><span class="sxs-lookup"><span data-stu-id="a6183-195">Because MRS is a component of Exchange Online, we can make changes in its code to address new forms of corruption that are detected in the future.</span></span> <span data-ttu-id="a6183-196">Por exemplo, se detectarmos um problema de consistência que o Sra não consegue corrigir, podemos analisar a corrupção, alterar o código da Sra e corrigir a inconsistência (se entendermos como).</span><span class="sxs-lookup"><span data-stu-id="a6183-196">For example, if we detect a consistency issue that MRS is not able to fix, we can analyze the corruption, change the MRS code and correct the inconsistency (if we understand how to).</span></span> 

## <a name="log-file-checks"></a><span data-ttu-id="a6183-197">Verificações de arquivo de log</span><span class="sxs-lookup"><span data-stu-id="a6183-197">Log File Checks</span></span> 
<span data-ttu-id="a6183-198">Todos os arquivos de log de transações gerados por um banco de dados do Exchange passam por várias formas de verificações de consistência.</span><span class="sxs-lookup"><span data-stu-id="a6183-198">All transaction log files generated by an Exchange database undergo several forms of consistency checks.</span></span> <span data-ttu-id="a6183-199">Quando um arquivo de log é criado, a primeira coisa executada é um padrão de bits é escrito e uma série de gravações de log é executada.</span><span class="sxs-lookup"><span data-stu-id="a6183-199">When a log file is created, the first thing done is a bit pattern is written and then a series of log writes is performed.</span></span> <span data-ttu-id="a6183-200">Isso permite que o Exchange Online execute uma série de verificações (liberação perdida, CRC e outras verificações) para validar cada arquivo de log conforme ele é gravado e, novamente, conforme é replicado.</span><span class="sxs-lookup"><span data-stu-id="a6183-200">This enables Exchange Online to execute a series of checks (lost flush, CRC and other checks) to validate each log file as it is written, and again as it is replicated.</span></span> 

## <a name="deployment-on-resilient-file-system"></a><span data-ttu-id="a6183-201">Implantação no sistema de arquivos resiliente</span><span class="sxs-lookup"><span data-stu-id="a6183-201">Deployment on Resilient File System</span></span> 
<span data-ttu-id="a6183-202">Para ajudar a evitar que os danos ocorram no nível do sistema de arquivos, o Exchange Online está sendo implantado em partições do sistema de arquivos resiliente (ReFS) para fornecer recursos de recuperação aprimorados.</span><span class="sxs-lookup"><span data-stu-id="a6183-202">To help prevent corruption from occurring at the file system level, Exchange Online is being deployed on Resilient File System (ReFS) partitions to provide improved recovery capabilities.</span></span> <span data-ttu-id="a6183-203">ReFS é um sistema de arquivos no Windows Server 2012 e posterior que é projetado para ser mais resistente em relação à corrupção de dados, maximizando a disponibilidade e a integridade dos dados.</span><span class="sxs-lookup"><span data-stu-id="a6183-203">ReFS is a file system in Windows Server 2012 and later that is designed to be more resilient against data corruption thereby maximizing data availability and integrity.</span></span> <span data-ttu-id="a6183-204">Especificamente, o ReFS traz melhorias na forma em que os metadados são atualizados, oferecendo melhor proteção para os dados e reduz os casos de corrupção de dados.</span><span class="sxs-lookup"><span data-stu-id="a6183-204">Specifically, ReFS brings improvements in the way that metadata is updated which offers better protection for data and reduces data corruption cases.</span></span> <span data-ttu-id="a6183-205">Ele também usa somas de verificação para verificar a integridade dos dados dos arquivos e dos metadados, garantindo que a corrupção dos dados seja facilmente encontrada e reparada.</span><span class="sxs-lookup"><span data-stu-id="a6183-205">It also uses checksums to verify the integrity of file data and metadata ensuring that data corruption is easily found and repaired.</span></span> 

<span data-ttu-id="a6183-206">O Exchange Online aproveita as vantagens de vários benefícios de ReFS:</span><span class="sxs-lookup"><span data-stu-id="a6183-206">Exchange Online takes advantage of several ReFS benefits:</span></span> 
- <span data-ttu-id="a6183-207">Mais resiliência na integridade dos dados significa menos incidentes de corrupção de dados.</span><span class="sxs-lookup"><span data-stu-id="a6183-207">More resiliency in data integrity means fewer data corruption incidents.</span></span> <span data-ttu-id="a6183-208">Reduzir o número de incidentes de corrupção significa menos resemente de banco de dados desnecessárias.</span><span class="sxs-lookup"><span data-stu-id="a6183-208">Reducing the number of corruption incidents means fewer unnecessary database reseeds.</span></span> 
- <span data-ttu-id="a6183-209">Checksum em execução em metadados permitindo detecções de casos de corrupção mais cedo e, de forma mais determinista, permitindo a correção dos dados de corrupção antes que as falhas de cinza ocorram nos volumes de dados.</span><span class="sxs-lookup"><span data-stu-id="a6183-209">Checksum running on metadata enabling detections of corruption cases sooner and more deterministically, allowing us to fix customer data corruption before grey failures occur on data volumes.</span></span>
- <span data-ttu-id="a6183-210">Projetado para funcionar bem com conjuntos de dados extremamente grandes — petabytes e maiores, sem impacto no desempenho</span><span class="sxs-lookup"><span data-stu-id="a6183-210">Designed to work well with extremely large data sets—petabytes and larger—without performance impact</span></span>
- <span data-ttu-id="a6183-211">Suporte para outros recursos usados pelo Exchange Online, como a criptografia BitLocker.</span><span class="sxs-lookup"><span data-stu-id="a6183-211">Support for other features used by Exchange Online, such as BitLocker encryption.</span></span> 

<span data-ttu-id="a6183-212">O Exchange Online também se beneficia de outros recursos ReFS:</span><span class="sxs-lookup"><span data-stu-id="a6183-212">Exchange Online also benefits from other ReFS features:</span></span> 
- <span data-ttu-id="a6183-213">**Integridade (fluxos de integridade)** -ReFS armazena dados de uma maneira que o protege de muitos dos erros comuns que podem normalmente causar perda de dados.</span><span class="sxs-lookup"><span data-stu-id="a6183-213">**Integrity (Integrity Streams)** - ReFS stores data in a way that protects it from many of the common errors that can normally cause data loss.</span></span> <span data-ttu-id="a6183-214">A pesquisa do Microsoft 365 usa fluxos de integridade para ajudar com a detecção de corrupção de disco inicial e somas de verificação do conteúdo do arquivo.</span><span class="sxs-lookup"><span data-stu-id="a6183-214">Microsoft 365 Search uses Integrity Streams to help with early disk corruption detection and checksums of file content.</span></span> <span data-ttu-id="a6183-215">O recurso também reduz incidentes de corrupção causados por "gravações rasgadas" (quando uma operação de gravação não é concluída devido a interrupções de energia, etc.).</span><span class="sxs-lookup"><span data-stu-id="a6183-215">The feature also reduces corruption incidents caused by “Torn Writes” (when a write operation does not complete due to power outages, etc.).</span></span> 
- <span data-ttu-id="a6183-216">**Disponibilidade (Salvage)** -ReFS prioriza a disponibilidade de dados.</span><span class="sxs-lookup"><span data-stu-id="a6183-216">**Availability (Salvage)** - ReFS prioritizes the availability of data.</span></span> <span data-ttu-id="a6183-217">Historicamente, os sistemas de arquivos geralmente eram suscetíveis à corrupção de dados que exigiria que o sistema fosse colocado offline para reparos.</span><span class="sxs-lookup"><span data-stu-id="a6183-217">Historically, file systems were often susceptible to data corruption that would require the system to be taken offline for repair.</span></span> <span data-ttu-id="a6183-218">Embora seja raro, se ocorrer corrupção, ReFS implementa Salvage, um recurso que remove os dados corrompidos do namespace em um volume ativo e garante que bons dados não sejam afetados de forma adversa por dados corrompidos não reemparelhados.</span><span class="sxs-lookup"><span data-stu-id="a6183-218">Although rare, if corruption does occur, ReFS implements salvage, a feature that removes the corrupt data from the namespace on a live volume and ensures that good data is not adversely affected by non-repairable corrupt data.</span></span> <span data-ttu-id="a6183-219">A aplicação do recurso Salvage e o isolamento dos dados corrompidos aos volumes do banco de dados do Exchange Online significa que podemos manter os bancos de dados não afetados em um volume corrompido em integridade entre o tempo de corrupção e a ação de reparo.</span><span class="sxs-lookup"><span data-stu-id="a6183-219">Applying the Salvage feature and isolating data corruption to Exchange Online database volumes means that we can keep non-affected databases on a corrupted volume healthy between the time of corruption and repair action.</span></span> <span data-ttu-id="a6183-220">Isso aumenta a disponibilidade de bancos de dados que normalmente seriam afetados por problemas de corrupção de disco.</span><span class="sxs-lookup"><span data-stu-id="a6183-220">This increases the availability of databases that would normally be affected by such disk corruption issues.</span></span> 